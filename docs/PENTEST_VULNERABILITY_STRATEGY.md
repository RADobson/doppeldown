# DoppelDown â€” Penetration Testing & Vulnerability Assessment Strategy

**Document Owner:** DoppelDown Security  
**Version:** 1.0  
**Created:** 2026-02-05  
**Next Review:** 2026-05-05 (quarterly)  
**Classification:** CONFIDENTIAL â€” Internal Use Only  
**Related Documents:** `COMPLIANCE_SECURITY_AUDIT.md`, `docs/DISASTER_RECOVERY_PLAN.md`, `TECH_DEBT_REGISTER.md`

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Strategy Overview & Objectives](#2-strategy-overview--objectives)
3. [Threat Model](#3-threat-model)
4. [Automated Vulnerability Scanning Program](#4-automated-vulnerability-scanning-program)
5. [Manual Penetration Testing Program](#5-manual-penetration-testing-program)
6. [Bug Bounty Program Design](#6-bug-bounty-program-design)
7. [Security Audit Preparation & Cadence](#7-security-audit-preparation--cadence)
8. [Vulnerability Management Lifecycle](#8-vulnerability-management-lifecycle)
9. [Security Testing in CI/CD](#9-security-testing-in-cicd)
10. [Red Team Exercises](#10-red-team-exercises)
11. [Metrics, Reporting & KPIs](#11-metrics-reporting--kpis)
12. [Tooling Stack](#12-tooling-stack)
13. [Budget & Resource Planning](#13-budget--resource-planning)
14. [Phased Implementation Roadmap](#14-phased-implementation-roadmap)
15. [Appendices](#15-appendices)

---

## 1. Executive Summary

DoppelDown is a brand protection and phishing detection SaaS platform. As a security product that handles sensitive brand intelligence, evidence collection (including third-party website scraping), payment processing, and AI-driven threat analysis, DoppelDown faces an elevated standard: **a security product with security vulnerabilities destroys customer trust irreparably.**

### Current Security Posture

The existing `COMPLIANCE_SECURITY_AUDIT.md` identified:
- **8 critical vulnerabilities** (SSRF, overprivileged DB grants, timing attacks, missing input validation, no encryption key management, service role key exposure, Puppeteer sandbox escape, race conditions)
- **14 high-severity issues** (no rate limiting, missing security headers, weak passwords, no MFA, insufficient audit logging)
- **19 medium-severity issues** (Docker root user, no dependency scanning, no log aggregation)
- **Zero test coverage** and no CI/CD security pipeline
- **Zero prior penetration tests** conducted

### Strategy Purpose

This document establishes a continuous, multi-layered security testing program covering:

| Layer | Purpose | Frequency |
|-------|---------|-----------|
| **Automated Scanning** | Catch known vulnerabilities, misconfigurations, dependency issues | Continuous (CI/CD) + Weekly + Monthly |
| **Manual Penetration Testing** | Find logic flaws, business-logic bypasses, chained exploits | Quarterly (internal) + Annual (external) |
| **Bug Bounty Program** | Crowd-source vulnerability discovery from the global security community | Always-on (after hardening Phase 1) |
| **Security Audits** | Formal compliance verification for SOC 2, GDPR, CCPA | Annual + pre-certification |
| **Red Team Exercises** | Simulate real-world adversary campaigns against DoppelDown infrastructure | Semi-annual (after Year 1 maturity) |

### Key Principle

> **"Test like an attacker, fix like an engineer, report like a regulator."**
>
> Every vulnerability finding follows the same lifecycle: Discover â†’ Triage â†’ Prioritize â†’ Remediate â†’ Verify â†’ Document. No exceptions.

---

## 2. Strategy Overview & Objectives

### 2.1 Strategic Objectives

| # | Objective | Success Criteria | Timeline |
|---|-----------|-----------------|----------|
| O1 | Achieve zero critical/high vulnerabilities in production | No unresolved critical findings >72h, no high findings >30d | Ongoing from Month 3 |
| O2 | Establish continuous automated security scanning | 100% of code changes scanned before merge; weekly infra scans | Month 2 |
| O3 | Complete first external penetration test | Clean report (no critical/high findings) before SOC 2 Type I | Month 8 |
| O4 | Launch responsible disclosure / bug bounty program | Program live with clear scope, SLA, and reward tiers | Month 6 |
| O5 | Pass SOC 2 Type I with no security exceptions | All CC7 (vulnerability management) controls evidenced | Month 10 |
| O6 | Achieve <14 day mean-time-to-remediation for high-severity findings | MTTR measured and trending downward quarter-over-quarter | Month 6 |
| O7 | Maintain security testing coverage across all attack surfaces | All OWASP Top 10 categories tested each quarter | Quarterly from Month 4 |

### 2.2 Scope Definition

#### In Scope

| Asset | Type | Environment | Priority |
|-------|------|-------------|----------|
| `doppeldown.com` (production web app) | Web Application | Production | **Critical** |
| Next.js API Routes (`/api/*`) | API Endpoints | Production + Staging | **Critical** |
| Supabase PostgreSQL (database + RLS policies) | Database | Production | **Critical** |
| Supabase Auth (authentication flows) | Identity | Production | **Critical** |
| Stripe integration (checkout, webhooks, portal) | Payment Processing | Production | **Critical** |
| Scan Worker (Node.js + Puppeteer on Oracle Cloud VPS) | Background Service | Production | **High** |
| Evidence Storage (Supabase Storage buckets) | Object Storage | Production | **High** |
| Docker container (worker environment) | Container | Production | **High** |
| CI/CD Pipeline (GitHub Actions) | Build Infrastructure | N/A (to be built) | **High** |
| OpenAI / SerpAPI / Google Vision integrations | Third-Party APIs | Production | **Medium** |
| DNS / Domain configuration | Infrastructure | Production | **Medium** |
| Email delivery (SMTP/Nodemailer) | Transactional Email | Production | **Medium** |
| Landing page + marketing pages | Web Content | Production | **Low** |

#### Out of Scope

| Asset | Reason |
|-------|--------|
| Supabase platform infrastructure | Covered by Supabase's own SOC 2 |
| Vercel platform infrastructure | Covered by Vercel's SOC 2 |
| Stripe platform infrastructure | Covered by Stripe's PCI DSS Level 1 |
| Oracle Cloud platform | Covered by OCI SOC 2 (shared responsibility) |
| Customer browsers / endpoints | Customer responsibility |
| Third-party API backends | Provider responsibility |

### 2.3 Testing Methodology Standards

All penetration testing and vulnerability assessments follow:

- **OWASP Testing Guide v4.2** â€” Web application testing methodology
- **OWASP Application Security Verification Standard (ASVS) v4.0** â€” Verification requirements
- **PTES (Penetration Testing Execution Standard)** â€” Engagement framework
- **NIST SP 800-115** â€” Technical guide to information security testing
- **CVSS v3.1** â€” Vulnerability scoring
- **CWE** â€” Weakness classification

---

## 3. Threat Model

### 3.1 DoppelDown-Specific Threat Landscape

DoppelDown's unique position as a **brand protection tool** creates a distinctive threat model:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THREAT ACTOR LANDSCAPE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PHISHING     â”‚  â”‚ COMPETITOR   â”‚  â”‚ DISGRUNTLED          â”‚  â”‚
â”‚  â”‚ OPERATORS    â”‚  â”‚ INTELLIGENCE â”‚  â”‚ TAKEDOWN TARGET      â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚ Motive:      â”‚  â”‚ Motive:      â”‚  â”‚ Motive:              â”‚  â”‚
â”‚  â”‚ Retaliate    â”‚  â”‚ Steal threat â”‚  â”‚ Destroy evidence,    â”‚  â”‚
â”‚  â”‚ against      â”‚  â”‚ data, scraperâ”‚  â”‚ disrupt detection,   â”‚  â”‚
â”‚  â”‚ detection    â”‚  â”‚ techniques,  â”‚  â”‚ corrupt reports      â”‚  â”‚
â”‚  â”‚              â”‚  â”‚ customer     â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚ Capability:  â”‚  â”‚ lists        â”‚  â”‚ Capability:          â”‚  â”‚
â”‚  â”‚ Moderate-    â”‚  â”‚              â”‚  â”‚ Low-Moderate         â”‚  â”‚
â”‚  â”‚ High         â”‚  â”‚ Capability:  â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚              â”‚  â”‚ Moderate     â”‚  â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                 â”‚                      â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OPPORTUNISTICâ”‚  â”‚ INSIDER      â”‚  â”‚ NATION-STATE         â”‚  â”‚
â”‚  â”‚ ATTACKER     â”‚  â”‚ THREAT       â”‚  â”‚ (UNLIKELY)           â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚ Motive:      â”‚  â”‚ Motive:      â”‚  â”‚ Motive:              â”‚  â”‚
â”‚  â”‚ Financial    â”‚  â”‚ Financial    â”‚  â”‚ Access to brand      â”‚  â”‚
â”‚  â”‚ gain, data   â”‚  â”‚ gain, IP     â”‚  â”‚ intelligence for     â”‚  â”‚
â”‚  â”‚ resale       â”‚  â”‚ theft        â”‚  â”‚ influence ops        â”‚  â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚ Capability:  â”‚  â”‚ Capability:  â”‚  â”‚ Capability:          â”‚  â”‚
â”‚  â”‚ Low-Moderate â”‚  â”‚ High (direct â”‚  â”‚ Very High            â”‚  â”‚
â”‚  â”‚              â”‚  â”‚ access)      â”‚  â”‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Attack Surface Decomposition

| Attack Surface | Entry Points | Threat Scenarios |
|---------------|-------------|-----------------|
| **Web Application** | Login, signup, password reset, dashboard forms, URL parameters | XSS, CSRF, authentication bypass, session hijacking, privilege escalation |
| **API Layer** | 12+ REST endpoints (`/api/brands`, `/api/scan`, `/api/reports`, etc.) | Injection attacks, IDOR, broken access control, mass assignment, API abuse |
| **Authentication** | Supabase Auth (email/password), JWT tokens, session cookies | Credential stuffing, brute force, token forgery, session fixation |
| **Payment Integration** | Stripe Checkout, webhook endpoint, customer portal | Payment bypass, subscription manipulation, webhook spoofing/replay |
| **Scan Engine** | Brand domain input â†’ URL construction â†’ HTTP fetching â†’ Puppeteer rendering | SSRF, DNS rebinding, command injection via crafted HTML, resource exhaustion |
| **Evidence Collection** | Screenshot capture, HTML archival, WHOIS lookups | SSRF (cloud metadata), storage poisoning, XSS in stored HTML, path traversal |
| **AI Integration** | OpenAI API calls with screenshot data, Google Vision API | Prompt injection (malicious content in screenshots), API key exfiltration, data leakage |
| **Background Worker** | PM2-managed process on Oracle VPS, Puppeteer/Chromium | Container escape, privilege escalation, worker impersonation, job queue poisoning |
| **Database** | Supabase PostgreSQL with RLS, service role key bypass | SQL injection (unlikely with Supabase client, but possible in raw queries), RLS bypass, privilege escalation via overprivileged grants |
| **Storage** | Supabase Storage buckets (evidence, logos) | Unauthorized access, direct object reference, signed URL leakage, storage quota exhaustion |
| **Email System** | Nodemailer SMTP, email templates | Header injection, phishing via spoofed alerts, information disclosure |
| **Cron Endpoints** | `/api/cron/scan`, `/api/cron/digest`, `/api/cron/nrd` | Unauthorized triggering, timing attacks on auth, resource exhaustion |
| **DNS/Infrastructure** | Domain registration, DNS records, TLS certificates | Domain hijacking, subdomain takeover, certificate transparency abuse |

### 3.3 STRIDE Analysis (Key Components)

| Component | Spoofing | Tampering | Repudiation | Information Disclosure | Denial of Service | Elevation of Privilege |
|-----------|----------|-----------|-------------|----------------------|-------------------|----------------------|
| **Auth System** | ðŸ”´ No MFA, weak passwords | ðŸŸ¡ JWT rotation exists | ðŸ”´ Insufficient audit logs | ðŸŸ¡ Error leakage | ðŸ”´ No rate limiting | ðŸŸ¡ Admin bypass pattern |
| **API Layer** | ðŸŸ¡ JWT-based | ðŸ”´ No input validation | ðŸ”´ Limited logging | ðŸ”´ Verbose errors | ðŸ”´ No rate limiting | ðŸ”´ Service role key exposure |
| **Scan Worker** | ðŸ”´ No worker auth | ðŸŸ¡ DB-backed queue | ðŸŸ¡ Scan logging exists | ðŸ”´ SSRF risk | ðŸŸ¡ Queue limits exist | ðŸ”´ Docker root + no sandbox |
| **Database** | ðŸŸ¡ RLS enforced | ðŸ”´ Overprivileged grants | ðŸŸ¡ Audit logging (partial) | ðŸŸ¡ RLS exists | ðŸŸ¡ Supabase managed | ðŸ”´ Service role bypass |
| **Storage** | ðŸ”´ No ownership check (IDOR) | ðŸŸ¡ Signed URLs | ðŸ”´ No access logging | ðŸ”´ Evidence signing IDOR | ðŸŸ¡ Bucket limits | ðŸŸ¡ RLS on storage |

### 3.4 Crown Jewels (Highest-Value Targets)

| Asset | Value | Impact if Compromised |
|-------|-------|----------------------|
| **Customer brand threat intelligence** | Competitive intelligence | Customer churn, competitive advantage lost, potential lawsuits |
| **Evidence collection (screenshots, HTML, WHOIS)** | Legal evidence for takedowns | Evidence tampering = failed takedowns, legal liability |
| **Customer payment data (Stripe integration)** | Financial | Regulatory fines, PCI implications if keys exposed |
| **AI analysis prompts and results** | IP / trade secret | Competitor replication of DoppelDown's detection engine |
| **Supabase Service Role Key** | Full database access | Total platform compromise â€” all customers, all data |
| **Customer email addresses and accounts** | PII | GDPR/CCPA fines, notification obligations, trust destruction |
| **Scan worker infrastructure** | Operational capability | Service disruption, use as attack pivot point |

---

## 4. Automated Vulnerability Scanning Program

### 4.1 Scanning Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 AUTOMATED SCANNING LAYERS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  LAYER 1: CODE-TIME (Every Commit)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Semgrep    â”‚ â”‚ ESLint     â”‚ â”‚ TypeScript â”‚ â”‚ npm audit  â”‚  â”‚
â”‚  â”‚ (SAST)     â”‚ â”‚ Security   â”‚ â”‚ Strict     â”‚ â”‚ (SCA)      â”‚  â”‚
â”‚  â”‚            â”‚ â”‚ Rules      â”‚ â”‚ Mode       â”‚ â”‚            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 2: BUILD-TIME (Every PR / Merge)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CodeQL     â”‚ â”‚ Snyk       â”‚ â”‚ Trivy      â”‚ â”‚ Secret     â”‚  â”‚
â”‚  â”‚ (Deep      â”‚ â”‚ (Dependency â”‚ â”‚ (Container â”‚ â”‚ Scanner    â”‚  â”‚
â”‚  â”‚  SAST)     â”‚ â”‚  + License) â”‚ â”‚  Scan)     â”‚ â”‚ (TruffleHogâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 3: DEPLOY-TIME (Every Deployment)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Nuclei     â”‚ â”‚ OWASP ZAP  â”‚ â”‚ SSL Labs   â”‚                  â”‚
â”‚  â”‚ (Nuclei    â”‚ â”‚ (Baseline  â”‚ â”‚ (TLS       â”‚                  â”‚
â”‚  â”‚  Templates)â”‚ â”‚  Scan)     â”‚ â”‚  Config)   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                  â”‚
â”‚  LAYER 4: RUNTIME (Continuous / Scheduled)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Nuclei     â”‚ â”‚ OWASP ZAP  â”‚ â”‚ Shodan     â”‚ â”‚ DNS/Cert   â”‚  â”‚
â”‚  â”‚ (Weekly    â”‚ â”‚ (Full      â”‚ â”‚ Monitor    â”‚ â”‚ Monitoring â”‚  â”‚
â”‚  â”‚  Full Scan)â”‚ â”‚  Active    â”‚ â”‚ (Asset     â”‚ â”‚ (CT Logs)  â”‚  â”‚
â”‚  â”‚            â”‚ â”‚  Monthly)  â”‚ â”‚  Exposure) â”‚ â”‚            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Layer 1: Code-Time Scanning (Every Commit)

**Purpose:** Catch vulnerabilities at the earliest possible moment â€” before code enters the repository.

#### 4.2.1 Semgrep (SAST)

**What:** Static Application Security Testing using pattern-based rules.

**Configuration:**
```yaml
# .semgrep.yml
rules:
  # DoppelDown-specific rules
  - id: dd-no-raw-sql
    patterns:
      - pattern: |
          $DB.rpc($FUNC, ...)
    message: "Raw SQL via RPC â€” ensure parameterized queries"
    languages: [typescript]
    severity: WARNING

  - id: dd-ssrf-check
    patterns:
      - pattern: |
          fetch($URL, ...)
      - pattern-not: |
          fetch($VALIDATED_URL, ...)
    message: "HTTP fetch without SSRF validation â€” use validateUrl() first"
    languages: [typescript]
    severity: ERROR

  - id: dd-service-role-usage
    patterns:
      - pattern: |
          createClient(..., process.env.SUPABASE_SERVICE_ROLE_KEY, ...)
    message: "Service role key usage â€” ensure this is necessary and documented"
    languages: [typescript]
    severity: WARNING

  - id: dd-no-timing-unsafe-compare
    patterns:
      - pattern: |
          $SECRET !== $INPUT
      - pattern: |
          $INPUT !== $SECRET
      - pattern: |
          $SECRET === $INPUT
      - pattern: |
          $INPUT === $SECRET
    message: "Use timingSafeEqual() for secret comparison"
    languages: [typescript]
    severity: ERROR

# Include community rulesets
include:
  - "p/typescript"
  - "p/nextjs"
  - "p/owasp-top-ten"
  - "p/jwt"
  - "p/sql-injection"
  - "p/xss"
  - "p/secrets"
```

**Integration:** Pre-commit hook + GitHub Actions.

```yaml
# .github/workflows/security-scan.yml (Layer 1 excerpt)
semgrep:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: returntocorp/semgrep-action@v1
      with:
        config: .semgrep.yml
        publishToken: ${{ secrets.SEMGREP_TOKEN }}
```

**Gate:** PR cannot merge with Semgrep `ERROR`-level findings.

#### 4.2.2 ESLint Security Rules

```json
// .eslintrc.json additions
{
  "plugins": ["security", "no-unsanitized"],
  "extends": ["plugin:security/recommended"],
  "rules": {
    "security/detect-object-injection": "warn",
    "security/detect-non-literal-regexp": "error",
    "security/detect-non-literal-require": "error",
    "security/detect-possible-timing-attacks": "error",
    "security/detect-eval-with-expression": "error",
    "security/detect-no-csrf-before-method-override": "error",
    "security/detect-unsafe-regex": "error",
    "no-unsanitized/method": "error",
    "no-unsanitized/property": "error"
  }
}
```

#### 4.2.3 npm audit (SCA)

```yaml
# In CI
npm-audit:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - run: npm ci
    - run: npm audit --audit-level=high
      # Fail on high+ severity dependency vulnerabilities
```

**Gate:** PR cannot merge with `high` or `critical` dependency vulnerabilities (with temporary allowlist for known false positives).

#### 4.2.4 Secret Detection (Pre-commit)

```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/trufflesecurity/trufflehog
    rev: v3.67.0
    hooks:
      - id: trufflehog
        args: ['--only-verified']
```

### 4.3 Layer 2: Build-Time Scanning (Every PR)

#### 4.3.1 CodeQL (Deep SAST)

```yaml
# .github/workflows/codeql-analysis.yml
name: CodeQL Analysis
on:
  pull_request:
    branches: [main]
  schedule:
    - cron: '0 6 * * 1'  # Weekly Monday 6AM UTC

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      security-events: write
    strategy:
      matrix:
        language: ['javascript']
    steps:
      - uses: actions/checkout@v4
      - uses: github/codeql-action/init@v3
        with:
          languages: ${{ matrix.language }}
          queries: security-extended,security-and-quality
      - uses: github/codeql-action/analyze@v3
```

**DoppelDown-Specific CodeQL Queries:**
- Taint tracking from `brand.domain` â†’ `fetch()` / `page.goto()` (SSRF detection)
- Service role key usage tracing
- Unvalidated user input to database queries
- JWT token handling issues

#### 4.3.2 Snyk (Dependency + License Scanning)

```yaml
snyk:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: snyk/actions/node@master
      with:
        command: test
        args: --severity-threshold=high
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    - uses: snyk/actions/node@master
      with:
        command: monitor
      env:
        SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

**Monitored:**
- Direct + transitive dependency vulnerabilities
- License compliance (reject GPL in production deps)
- Container vulnerabilities (Docker image)

#### 4.3.3 Trivy (Container Scanning)

```yaml
trivy-container:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: Build Docker image
      run: docker build -t doppeldown-worker:test .
    - uses: aquasecurity/trivy-action@master
      with:
        image-ref: 'doppeldown-worker:test'
        format: 'sarif'
        output: 'trivy-results.sarif'
        severity: 'CRITICAL,HIGH'
        exit-code: '1'
    - uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: 'trivy-results.sarif'
```

#### 4.3.4 TruffleHog (Secret Scanning)

```yaml
trufflehog:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Full history for secret detection
    - uses: trufflesecurity/trufflehog@main
      with:
        extra_args: --only-verified
```

### 4.4 Layer 3: Deploy-Time Scanning (Every Deployment)

#### 4.4.1 OWASP ZAP Baseline Scan

Run after every deployment to staging:

```yaml
zap-baseline:
  runs-on: ubuntu-latest
  needs: [deploy-staging]
  steps:
    - uses: zaproxy/action-baseline@v0.10.0
      with:
        target: 'https://staging.doppeldown.com'
        rules_file_name: '.zap/rules.tsv'
        cmd_options: '-j -a'
    - uses: actions/upload-artifact@v4
      with:
        name: zap-baseline-report
        path: report_html.html
```

**Custom ZAP rules for DoppelDown:**
```tsv
# .zap/rules.tsv
10038	IGNORE	# Content Security Policy - will be tuned separately
10098	IGNORE	# Cross-Domain Misconfiguration - expected for Supabase
90033	WARN	# Loosely Scoped Cookie
10020	FAIL	# Anti-clickjacking Header Missing
10021	FAIL	# X-Content-Type-Options Missing
10036	FAIL	# Server Leaks Information
```

#### 4.4.2 SSL/TLS Verification

```bash
# scripts/check-tls.sh
#!/bin/bash
set -euo pipefail

DOMAIN="${1:-doppeldown.com}"
RESULT=$(curl -sI "https://${DOMAIN}" 2>&1)

# Check HSTS
if ! echo "$RESULT" | grep -qi "strict-transport-security"; then
  echo "FAIL: Missing HSTS header"
  exit 1
fi

# SSL Labs API check
GRADE=$(curl -s "https://api.ssllabs.com/api/v3/analyze?host=${DOMAIN}&fromCache=on" | jq -r '.endpoints[0].grade')
if [[ "$GRADE" != "A" && "$GRADE" != "A+" ]]; then
  echo "FAIL: SSL Labs grade is ${GRADE}, expected A or A+"
  exit 1
fi

echo "PASS: TLS configuration verified"
```

#### 4.4.3 Security Header Verification

```bash
# scripts/check-headers.sh
#!/bin/bash
set -euo pipefail

DOMAIN="${1:-doppeldown.com}"
HEADERS=$(curl -sI "https://${DOMAIN}")

REQUIRED_HEADERS=(
  "strict-transport-security"
  "x-content-type-options"
  "x-frame-options"
  "referrer-policy"
  "permissions-policy"
  "content-security-policy"
)

FAILED=0
for header in "${REQUIRED_HEADERS[@]}"; do
  if ! echo "$HEADERS" | grep -qi "$header"; then
    echo "FAIL: Missing header: $header"
    FAILED=1
  fi
done

if [ $FAILED -eq 1 ]; then
  exit 1
fi
echo "PASS: All security headers present"
```

### 4.5 Layer 4: Runtime Scanning (Scheduled)

#### 4.5.1 Nuclei â€” Weekly Vulnerability Scan

```yaml
# Nuclei scanning configuration
# Run every Sunday at 02:00 UTC via GitHub Actions cron

name: Weekly Nuclei Scan
on:
  schedule:
    - cron: '0 2 * * 0'  # Sunday 2 AM UTC
  workflow_dispatch:       # Manual trigger

jobs:
  nuclei-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Nuclei
        run: |
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          nuclei -update-templates
      - name: Run Nuclei Scan
        run: |
          nuclei -target https://doppeldown.com \
            -t cves/ \
            -t vulnerabilities/ \
            -t misconfigurations/ \
            -t exposures/ \
            -t technologies/ \
            -t default-logins/ \
            -severity critical,high,medium \
            -rate-limit 10 \
            -output nuclei-results.json \
            -jsonl \
            -silent
      - name: Process Results
        run: |
          CRITICAL=$(grep -c '"severity":"critical"' nuclei-results.json || true)
          HIGH=$(grep -c '"severity":"high"' nuclei-results.json || true)
          echo "Critical: $CRITICAL, High: $HIGH"
          if [ "$CRITICAL" -gt 0 ]; then
            echo "::error::Critical vulnerabilities found!"
            # Send alert to security channel
          fi
      - uses: actions/upload-artifact@v4
        with:
          name: nuclei-weekly-${{ github.run_number }}
          path: nuclei-results.json
          retention-days: 90
```

**Custom Nuclei templates for DoppelDown:**

```yaml
# nuclei-templates/doppeldown/cron-auth-bypass.yaml
id: doppeldown-cron-bypass
info:
  name: DoppelDown Cron Endpoint Authentication Bypass
  severity: critical
  description: Tests for unauthenticated access to cron endpoints

requests:
  - method: GET
    path:
      - "{{BaseURL}}/api/cron/scan"
      - "{{BaseURL}}/api/cron/digest"
      - "{{BaseURL}}/api/cron/nrd"
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "success"
          - "processed"
        condition: or
```

```yaml
# nuclei-templates/doppeldown/ssrf-check.yaml
id: doppeldown-ssrf
info:
  name: DoppelDown SSRF via Brand Domain
  severity: critical
  description: Tests if brand creation allows internal IP scanning

# Note: This requires authenticated access - use with session token
```

#### 4.5.2 OWASP ZAP â€” Monthly Full Active Scan

```yaml
name: Monthly ZAP Full Scan
on:
  schedule:
    - cron: '0 3 1 * *'  # 1st of each month, 3 AM UTC

jobs:
  zap-full:
    runs-on: ubuntu-latest
    steps:
      - uses: zaproxy/action-full-scan@v0.9.0
        with:
          target: 'https://staging.doppeldown.com'
          rules_file_name: '.zap/rules.tsv'
          cmd_options: '-j -a -T 60'
          # Authenticated scan configuration
          context_file: '.zap/doppeldown-context.context'
```

**Authenticated ZAP scanning:**
- Configure ZAP with a test account session token
- Spider + active scan all authenticated pages
- Test all API endpoints with valid + invalid auth states
- Include AJAX spider for SPA content discovery

#### 4.5.3 Asset Discovery & Exposure Monitoring

```bash
# Monthly asset discovery
# Detect any new subdomains, exposed services, or unexpected certificates

# Subdomain enumeration
subfinder -d doppeldown.com -o subdomains.txt

# Certificate Transparency monitoring
curl -s "https://crt.sh/?q=%25.doppeldown.com&output=json" | \
  jq -r '.[].name_value' | sort -u

# Shodan monitoring (if applicable)
shodan search "ssl.cert.subject.cn:doppeldown.com"

# DNS record monitoring
dig +short doppeldown.com A AAAA CNAME MX TXT NS
```

### 4.6 Scanning Schedule Summary

| Scanner | Layer | Frequency | Scope | Gate/Action |
|---------|-------|-----------|-------|-------------|
| Semgrep | Code-time | Every commit | Changed files | Block PR on ERROR |
| ESLint Security | Code-time | Every commit | Changed files | Block PR on error |
| npm audit | Code-time | Every CI run | Dependencies | Block on high+ |
| TruffleHog | Code-time | Pre-commit + PR | Git history | Block on verified secrets |
| CodeQL | Build-time | Every PR + weekly | Full codebase | Alert on high+ |
| Snyk | Build-time | Every PR + daily | Deps + container | Block on high+ |
| Trivy | Build-time | Every Docker build | Container image | Block on critical/high |
| ZAP Baseline | Deploy-time | Every staging deploy | Web app surface | Alert on FAIL rules |
| Header Check | Deploy-time | Every deploy | HTTP headers | Block deploy on failure |
| TLS Check | Deploy-time | Every deploy | TLS config | Block deploy on <A grade |
| Nuclei | Runtime | Weekly | Production | Alert on critical/high |
| ZAP Full | Runtime | Monthly | Staging (auth'd) | Report for manual review |
| Asset Discovery | Runtime | Monthly | Domain + infra | Alert on new findings |
| Dependency Check | Runtime | Daily (Dependabot) | All deps | Auto-PR for patches |

---

## 5. Manual Penetration Testing Program

### 5.1 Testing Calendar

```
         Q1 (Feb-Apr)       Q2 (May-Jul)       Q3 (Aug-Oct)       Q4 (Nov-Jan)
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Internal â”‚ â–  Auth &        â”‚ â–  API & Biz      â”‚ â–  Worker &       â”‚ â–  Full
Pentest  â”‚   Access Ctrl   â”‚   Logic          â”‚   Infrastructure â”‚   Regression
         â”‚   (2 weeks)     â”‚   (2 weeks)      â”‚   (2 weeks)      â”‚   (2 weeks)
         â”‚                 â”‚                  â”‚                  â”‚
External â”‚                 â”‚                  â”‚ â–  Annual         â”‚
Pentest  â”‚                 â”‚                  â”‚   External       â”‚
         â”‚                 â”‚                  â”‚   (3-4 weeks)    â”‚
         â”‚                 â”‚                  â”‚                  â”‚
Red Team â”‚                 â”‚                  â”‚                  â”‚ â–  Adversary
Exercise â”‚                 â”‚                  â”‚                  â”‚   Simulation
         â”‚                 â”‚                  â”‚                  â”‚   (Year 2+)
```

### 5.2 Internal Penetration Testing

#### 5.2.1 Quarterly Focus Areas

**Q1: Authentication & Access Control (Februaryâ€“April)**

| Test Area | Test Cases | OWASP Category |
|-----------|-----------|----------------|
| Authentication | Credential stuffing, brute force (w/ and w/o rate limits), password policy bypass, account enumeration via error messages, session fixation, JWT manipulation | A07:2021 Identification and Authentication Failures |
| Session Management | Session timeout verification, session revocation on password change, concurrent session handling, cookie security flags (Secure, HttpOnly, SameSite) | A07:2021 |
| Access Control | Horizontal privilege escalation (access other users' brands/threats/reports), vertical privilege escalation (user â†’ admin), IDOR on all resource endpoints, direct object reference in evidence signing | A01:2021 Broken Access Control |
| MFA (when implemented) | MFA bypass techniques, MFA enrollment race conditions, backup code security | A07:2021 |
| Subscription Tier Bypass | Free user accessing paid features, tier limit bypass via race conditions, manual scan quota circumvention | Business Logic |

**Detailed Test Procedures â€” Q1:**

```
TEST-AUTH-001: Account Enumeration
  1. Attempt login with valid email + wrong password
  2. Attempt login with invalid email + any password
  3. Compare response messages, timing, and HTTP status codes
  4. Expected: Identical responses for both cases
  
TEST-AUTH-002: JWT Token Manipulation  
  1. Capture valid JWT from Supabase Auth
  2. Decode payload, modify user_id/role
  3. Re-sign with empty key / "none" algorithm
  4. Submit modified token to protected endpoints
  5. Expected: Rejected with 401
  
TEST-AUTH-003: Password Reset Flow
  1. Request password reset for valid email
  2. Check for rate limiting on reset requests
  3. Attempt to reuse old reset tokens
  4. Check token expiration enforcement
  5. Test password reset with weak passwords (< 8 chars)
  
TEST-AC-001: Horizontal Privilege Escalation (Brands)
  1. Authenticate as User A, note brand IDs
  2. Authenticate as User B
  3. Attempt: GET /api/brands/{userA_brand_id} as User B
  4. Attempt: PUT /api/brands/{userA_brand_id} as User B
  5. Attempt: DELETE /api/brands/{userA_brand_id} as User B
  6. Expected: 404 (not 403) for all attempts
  
TEST-AC-002: Evidence Signing IDOR (TD-003)
  1. Authenticate as User A, start scan, get evidence file paths
  2. Authenticate as User B
  3. Attempt: POST /api/evidence/sign with User A's file paths
  4. Expected: Rejected (currently VULNERABLE per tech debt register)
  
TEST-AC-003: Admin Escalation
  1. Authenticate as regular user
  2. Attempt to modify is_admin column via Supabase client
  3. Attempt to access admin-only endpoints
  4. Verify RLS prevents is_admin self-modification
  
TEST-AC-004: Scan Quota Race Condition (VULN-C8)
  1. Authenticate as Free tier user (1 manual scan/week)
  2. Send 10 concurrent POST /api/scan requests
  3. Count how many succeed (should be 1)
  4. Expected: Atomic check-and-increment (currently VULNERABLE)
```

**Q2: API & Business Logic (Mayâ€“July)**

| Test Area | Test Cases | OWASP Category |
|-----------|-----------|----------------|
| Input Validation | SQL injection in all string params, XSS payloads in brand names/keywords, command injection via domain field, path traversal in file-related endpoints | A03:2021 Injection |
| Business Logic | Scan initiation without subscription, report generation for non-owned brands, Stripe webhook replay, subscription downgrade data retention, payment bypass | Business Logic |
| API Abuse | Mass brand creation, scan flooding, evidence download enumeration, API endpoint discovery | A04:2021 Insecure Design |
| Data Exposure | Excessive data in API responses, PII in error messages, stack traces, database query exposure in responses | A01:2021 |
| Stripe Integration | Webhook signature bypass, checkout session manipulation, subscription status tampering, price ID substitution | Payment Logic |

**Detailed Test Procedures â€” Q2:**

```
TEST-INJ-001: SSRF via Brand Domain
  1. Create brand with domain: 169.254.169.254
  2. Trigger scan
  3. Check evidence collection for AWS metadata
  4. Create brand with domain: 127.0.0.1:5432
  5. Create brand with domain pointing to DNS rebind service
  6. Expected: All blocked by SSRF protection (validate after fix)

TEST-INJ-002: XSS in Stored Brand Data
  1. Create brand with name: <script>alert(1)</script>
  2. Create brand with domain: test.com" onload="alert(1)
  3. Create brand with keywords: ["<img src=x onerror=alert(1)>"]
  4. Navigate to dashboard, brand detail, reports
  5. Expected: All payloads HTML-encoded in output

TEST-BL-001: Stripe Price ID Manipulation
  1. Intercept Stripe checkout creation request
  2. Replace price_id with a different product's price
  3. Replace price_id with a non-existent ID
  4. Complete checkout with manipulated price
  5. Verify server validates price_id against expected tiers

TEST-BL-002: Webhook Replay Attack
  1. Capture valid Stripe webhook payload
  2. Replay exact same payload 60 seconds later
  3. Replay with modified timestamp header
  4. Expected: Replay rejected (timestamp tolerance check)

TEST-BL-003: Report Generation Authorization
  1. As User A, identify a scan_id belonging to User A
  2. As User B, POST /api/reports { scan_id: userA_scan_id }
  3. Expected: Rejected (scan ownership verified)
```

**Q3: Worker & Infrastructure (Augustâ€“October)**

| Test Area | Test Cases | OWASP Category |
|-----------|-----------|----------------|
| Scan Worker | Worker authentication, job queue poisoning, Puppeteer sandbox escape, malicious page rendering, resource exhaustion via crafted pages | A05:2021 Security Misconfiguration |
| Docker Security | Container escape attempts, privilege escalation within container, image vulnerability assessment, secret exposure in container env | A05:2021 |
| Infrastructure | VPS hardening assessment, SSH configuration, PM2 security, network segmentation, firewall rules | Infrastructure |
| Database | RLS policy completeness, service role key usage audit, backup security, Supabase dashboard access controls | A01:2021 |
| Third-Party Integrations | OpenAI API key security, SerpAPI key rotation, Google Vision key scope, SMTP credential security | A09:2021 Security Logging and Monitoring Failures |

**Detailed Test Procedures â€” Q3:**

```
TEST-INFRA-001: Worker VPS Assessment
  1. External port scan: nmap -sV -p- 159.13.34.62
  2. Verify only SSH (22) and necessary ports open
  3. Check SSH config: PasswordAuthentication, PermitRootLogin
  4. Verify PM2 runs as non-root user
  5. Check for unnecessary services
  6. Review iptables/nftables rules

TEST-INFRA-002: Docker Container Escape
  1. Craft a malicious web page with Chrome exploit PoC
  2. Verify Puppeteer sandbox prevents file system access
  3. Test --no-sandbox impact (currently VULNERABLE)
  4. Verify container has no unnecessary capabilities
  5. Test read access to /proc/1/environ (secrets leak)

TEST-INFRA-003: Database RLS Completeness
  1. For each table, attempt CRUD as anon role
  2. For each table, attempt cross-user access as authenticated
  3. Verify RLS policies on all columns (especially JSONB)
  4. Test RLS with edge cases (NULL user_id, empty brand_id)
  5. Verify service role usage is minimized and audited

TEST-INFRA-004: Malicious Page Rendering
  1. Create brand domain pointing to page with:
     a. <meta http-equiv="refresh"> loop (resource exhaustion)
     b. JavaScript crypto miner
     c. 100MB response body
     d. Infinite redirect chain
     e. WebSocket connection to internal services
  2. Verify Puppeteer resource limits, timeout, and sandboxing
```

**Q4: Full Regression (Novemberâ€“January)**

- Full coverage of Q1â€“Q3 test cases
- Verification of all previously remediated vulnerabilities
- New feature security assessment
- Pre-annual-external-pentest preparation
- SOC 2 evidence collection

### 5.3 External Penetration Testing

#### 5.3.1 Vendor Selection Criteria

| Criterion | Weight | Requirements |
|-----------|--------|-------------|
| SaaS/Cloud expertise | 25% | Experience with Next.js, Supabase, Vercel, Stripe integrations |
| Methodology | 20% | OWASP, PTES, NIST 800-115, CVSS scoring |
| Reputation | 20% | Recognized in security community, published research |
| Reporting quality | 15% | Executive summary, technical details, reproduction steps, remediation guidance |
| Retest inclusion | 10% | Free retest within 90 days of remediation |
| Price | 10% | Within budget ($15Kâ€“$30K for comprehensive engagement) |

#### 5.3.2 Recommended Vendors (Startup-Friendly)

| Vendor | Specialty | Est. Cost | Notes |
|--------|-----------|-----------|-------|
| **Cobalt** | Pentest-as-a-Service | $15Kâ€“$25K | Crowdsourced, fast turnaround, SOC 2 accepted |
| **HackerOne Pentest** | Managed pentest | $20Kâ€“$35K | Leverages bug bounty researcher pool |
| **Bugcrowd Pen Testing** | Managed pentest | $20Kâ€“$35K | Good for startups, compliance-ready reports |
| **Bishop Fox** | Premium consulting | $30Kâ€“$60K | Tier 1 firm, excellent for SOC 2 evidence |
| **Cure53** | Web app security | $20Kâ€“$40K | Known for thorough web/API testing |
| **Doyensec** | Application security | $15Kâ€“$25K | Specializes in SaaS platforms |

#### 5.3.3 Engagement Scope Template

```markdown
# DoppelDown External Penetration Test â€” Scope of Work

## Objective
Identify security vulnerabilities in the DoppelDown web application,
API layer, and supporting infrastructure that could be exploited by
an external attacker to compromise confidentiality, integrity, or
availability of the platform and its customers' data.

## Target Environment
- Production-equivalent staging environment: staging.doppeldown.com
- API endpoints: staging.doppeldown.com/api/*
- Scan worker: [Separate VPS, details to be shared under NDA]

## Test Types
1. **Web Application Penetration Test** (OWASP Top 10 + business logic)
2. **API Security Assessment** (all REST endpoints)
3. **Authentication & Authorization Testing** (Supabase Auth integration)
4. **Payment Integration Security** (Stripe flows)
5. **Infrastructure Assessment** (VPS, Docker, network)
6. **Cloud Configuration Review** (Supabase, Vercel, Oracle Cloud settings)

## Test Accounts Provided
- Free tier user account
- Starter tier user account
- Professional tier user account
- Admin user account (for privilege escalation testing)

## Rules of Engagement
- Testing window: [DATE] to [DATE], business hours + off-hours
- No denial-of-service testing against production
- Social engineering: OUT OF SCOPE
- Physical security: OUT OF SCOPE
- Production data access: PROHIBITED (staging only)
- Communication channel: Encrypted email / Signal group
- Emergency contact: [PHONE]

## Deliverables
1. Executive Summary (1â€“2 pages, non-technical)
2. Technical Report (detailed findings with CVSS scores)
3. Proof-of-concept for each vulnerability
4. Remediation recommendations (prioritized)
5. Retest report (within 90 days)

## Compliance Context
- Report will be used as SOC 2 Type I/II evidence (CC7.1)
- Report format must be acceptable to [AUDITOR NAME]
```

#### 5.3.4 Annual Pentest Timeline

```
Week 1:     Kickoff meeting, scope confirmation, test account provisioning
Week 2-3:   Active testing phase
Week 3:     Interim findings call (critical/high findings communicated immediately)
Week 4:     Report drafting and delivery
Week 5-8:   Remediation phase (internal team)
Week 9:     Retest engagement
Week 10:    Final report with retest results
```

### 5.4 Pentest Report Requirements

Every penetration test report (internal or external) must include:

| Section | Content |
|---------|---------|
| **Executive Summary** | Business-risk narrative, overall risk rating, key metrics |
| **Scope & Methodology** | What was tested, how, any limitations |
| **Finding Detail** | Title, CVSS 3.1 score, CWE ID, description, proof-of-concept, impact, affected component, reproduction steps |
| **Remediation Guidance** | Specific fix, code example where applicable, priority |
| **Risk Heat Map** | Visual severity Ã— likelihood matrix |
| **Positive Findings** | What's working well (important for SOC 2 evidence) |
| **Appendix** | Tool output, raw data, testing checklist completion |

---

## 6. Bug Bounty Program Design

### 6.1 Program Strategy

**Phase 1 (Month 6): Private Bug Bounty**
- Invite 20â€“30 vetted researchers via HackerOne or Bugcrowd
- Controlled scope, limited brand risk
- Validate program processes before going public

**Phase 2 (Month 9): Expanded Private**
- Increase researcher pool to 100+
- Expand scope to include API and worker
- Tune reward tiers based on Phase 1 data

**Phase 3 (Month 12+): Public Bug Bounty**
- Open to all researchers
- Full scope
- Marketing value: "We're a security company that invites hackers to test us"

### 6.2 Program Scope

#### In Scope

| Target | Priority | Notes |
|--------|----------|-------|
| `*.doppeldown.com` | **Primary** | All web application functionality |
| API endpoints (`/api/*`) | **Primary** | Authenticated and unauthenticated |
| Authentication flows | **Primary** | Login, signup, password reset, session management |
| Access control | **Primary** | IDOR, privilege escalation, tier bypass |
| Payment integration | **Primary** | Stripe checkout manipulation, subscription bypass |
| Evidence collection | **Secondary** | SSRF, data exposure |
| Email functionality | **Secondary** | Header injection, spoofing |

#### Out of Scope

| Target | Reason |
|--------|--------|
| Third-party services (Supabase, Stripe, Vercel, OpenAI) | Report to respective vendor programs |
| Social engineering / phishing attacks on DoppelDown employees | Not part of technical assessment |
| Denial of Service (DoS/DDoS) | Infrastructure risk, test in controlled environment only |
| Automated mass scanning without coordination | Must not disrupt production |
| Physical security | N/A (cloud-hosted) |
| Rate limiting findings without demonstrated business impact | Noise reduction |
| Self-XSS (requires victim to paste code in browser console) | Low impact |
| Missing security headers without demonstrated exploit chain | Already tracked internally |
| SPF/DKIM/DMARC configuration issues | Low impact for application security |

### 6.3 Reward Structure

| Severity | CVSS Range | Reward (Private) | Reward (Public) | Examples |
|----------|-----------|-------------------|-----------------|----------|
| **Critical** | 9.0â€“10.0 | $1,000â€“$3,000 | $2,000â€“$5,000 | RCE, full DB access, auth bypass affecting all users, payment system compromise |
| **High** | 7.0â€“8.9 | $500â€“$1,000 | $1,000â€“$2,500 | SSRF with internal network access, stored XSS on main app, IDOR exposing customer data, privilege escalation |
| **Medium** | 4.0â€“6.9 | $200â€“$500 | $400â€“$1,000 | CSRF on sensitive actions, information disclosure (PII), session management flaws |
| **Low** | 0.1â€“3.9 | $50â€“$200 | $100â€“$400 | Reflected XSS requiring social engineering, verbose error messages, minor information leaks |

**Bonus Multipliers:**
- Exploit chain combining multiple vulnerabilities: **1.5x**
- First critical finding in a new feature area: **1.25x**
- Exceptional write-up quality: **1.25x**
- Finding in evidence collection / AI analysis path: **1.25x** (crown jewel protection)

**Monthly Program Budget:**
- Phase 1 (Private): $2,000â€“$5,000/month
- Phase 2 (Expanded): $3,000â€“$8,000/month
- Phase 3 (Public): $5,000â€“$15,000/month

### 6.4 Response SLAs

| Severity | First Response | Triage Decision | Fix Target | Researcher Update |
|----------|---------------|-----------------|------------|-------------------|
| **Critical** | 4 hours | 24 hours | 72 hours | Every 24 hours |
| **High** | 8 hours | 48 hours | 14 days | Every 3 days |
| **Medium** | 24 hours | 5 business days | 30 days | Every 7 days |
| **Low** | 48 hours | 10 business days | 90 days | Every 14 days |

### 6.5 Vulnerability Disclosure Policy

```markdown
# DoppelDown Responsible Disclosure Policy

## Introduction
DoppelDown welcomes security researchers who help us keep our platform 
and customers safe. This policy describes how to report vulnerabilities 
and what you can expect from us.

## Reporting
Email: security@doppeldown.com
PGP Key: [link to public key]
Bug Bounty: https://hackerone.com/doppeldown (or Bugcrowd equivalent)

## Our Commitments
- We will acknowledge your report within 24 hours
- We will not take legal action against researchers acting in good faith
- We will keep you informed of remediation progress
- We will publicly credit you (unless you prefer anonymity)
- We will pay rewards per our published reward table

## Your Commitments
- Do not access, modify, or delete customer data
- Do not disrupt our services or other users
- Report vulnerabilities promptly and do not disclose publicly
  until we confirm remediation (90-day maximum disclosure timeline)
- Do not use automated scanners without coordination
- Provide sufficient detail for us to reproduce the issue

## Safe Harbor
We consider security research conducted consistent with this policy 
to be authorized and will not pursue legal action. If legal action is 
initiated by a third party, we will take steps to make it known that 
your actions were authorized by us.

## Scope
See our bug bounty program page for current in-scope and out-of-scope 
targets.
```

### 6.6 Triage Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Report     â”‚    â”‚   Triage     â”‚    â”‚  Validate    â”‚
â”‚   Received   â”‚â”€â”€â”€>â”‚   (Auto +    â”‚â”€â”€â”€>â”‚  & Reproduce â”‚
â”‚              â”‚    â”‚   Manual)    â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Duplicate?  â”‚     â”‚  Valid?      â”‚
                    â”‚  OOS?        â”‚     â”‚              â”‚
                    â”‚  Informative?â”‚     â”‚  YES    NO   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                           â”‚                â”‚       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”  â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Close with  â”‚  â”‚ Assign â”‚  â”‚ Close:     â”‚
                    â”‚  explanation â”‚  â”‚ CVSS   â”‚  â”‚ Not Applic â”‚
                    â”‚  + bounty if â”‚  â”‚ + Fix  â”‚  â”‚ / Won't Fixâ”‚
                    â”‚  informative â”‚  â”‚ Owner  â”‚  â”‚            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚  Verify Fix  â”‚  â”‚  Implement â”‚
                    â”‚  + Researcherâ”‚  â”‚  Fix       â”‚
                    â”‚  Retest      â”‚  â”‚            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Pay Bounty  â”‚
                    â”‚  + Public    â”‚
                    â”‚  Disclosure  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.7 Platform Selection

| Platform | Pros | Cons | Recommendation |
|----------|------|------|----------------|
| **HackerOne** | Largest researcher pool, SOC 2 accepted, managed triage option, strong reputation | Higher platform fees (20â€“25%), can be noisy | **Recommended for Phase 1â€“2** |
| **Bugcrowd** | Good managed triage, researcher quality controls, CrowdMatch | Smaller pool than HackerOne | Good alternative |
| **Intigriti** | European focus (good for GDPR narrative), growing pool | Smaller researcher pool | Consider for EU positioning |
| **Self-hosted** | Full control, no platform fees | Operational overhead, less researcher trust | **Not recommended** for startup |

**Recommendation:** Start with **HackerOne** for researcher pool size and SOC 2 recognition. Budget ~$500/month platform fee on top of bounty payouts.

---

## 7. Security Audit Preparation & Cadence

### 7.1 Audit Types & Schedule

| Audit Type | Frequency | Scope | Conducted By | SOC 2 Mapping |
|------------|-----------|-------|-------------|---------------|
| **Internal Security Assessment** | Quarterly | Full application + infrastructure | Internal / automated tools | CC4.1, CC4.2 |
| **Dependency Audit** | Monthly | All npm dependencies + Docker base images | Automated (Snyk/Dependabot) | CC7.1 |
| **Access Control Review** | Quarterly | All user accounts, service accounts, API keys | Internal | CC6.1â€“CC6.3 |
| **RLS Policy Audit** | Quarterly | All Supabase RLS policies | Internal | CC6.1 |
| **Configuration Audit** | Quarterly | Vercel, Supabase, Oracle VPS, DNS | Internal | CC5.2, CC6.6 |
| **External Penetration Test** | Annually | Full scope (see Â§5.3) | Third-party vendor | CC7.1, CC3.1 |
| **SOC 2 Type I Audit** | Once (Year 1) | All trust service criteria | CPA firm | Full TSC |
| **SOC 2 Type II Audit** | Annually (Year 2+) | All trust service criteria, 6-month observation | CPA firm | Full TSC |
| **GDPR Compliance Audit** | Annually | GDPR Article 5â€“49 compliance | Internal + legal counsel | Privacy criteria |
| **CCPA Compliance Audit** | Annually | CCPA/CPRA requirements | Internal + legal counsel | Privacy criteria |
| **Vendor Security Assessment** | Annually | All third-party processors | Internal | CC9.2 |
| **Incident Response Drill** | Semi-annually | IR plan effectiveness | Internal | CC7.3â€“CC7.5 |
| **Disaster Recovery Test** | Quarterly | DR plan per `DISASTER_RECOVERY_PLAN.md` | Internal | A1.3 |

### 7.2 Pre-Audit Preparation Checklist

#### 30 Days Before Any Formal Audit

```markdown
## Pre-Audit Checklist (T-30 days)

### Evidence Collection
- [ ] Export all GitHub PR review logs (6 months)
- [ ] Export all deployment logs from Vercel (6 months)
- [ ] Screenshot current security configurations:
  - [ ] Supabase RLS policies
  - [ ] Supabase Auth settings (password policy, MFA)
  - [ ] Vercel environment variable list (names only, not values)
  - [ ] Oracle VPS firewall rules
  - [ ] GitHub branch protection rules
  - [ ] GitHub Actions workflow configurations
- [ ] Generate vulnerability scan reports (latest):
  - [ ] Nuclei scan results
  - [ ] ZAP scan report
  - [ ] Snyk dependency report
  - [ ] Trivy container scan report
  - [ ] npm audit output
- [ ] Collect access review evidence:
  - [ ] User account list with roles
  - [ ] Service account inventory
  - [ ] API key inventory (last rotation dates)
  - [ ] GitHub collaborator list
  - [ ] Supabase dashboard access list
  - [ ] Vercel team member list

### Policy Review
- [ ] All security policies reviewed and signed by owner
- [ ] Policy version history documented
- [ ] Policy exceptions documented and approved
- [ ] Employee/contractor security acknowledgments current

### Remediation Verification
- [ ] All critical/high pentest findings remediated
- [ ] Retest evidence available for each remediation
- [ ] Known exceptions documented with risk acceptance

### Process Evidence
- [ ] Incident response drill conducted within last 6 months
- [ ] DR test conducted within last quarter
- [ ] Security training completion records
- [ ] Change management process evidence (sample PRs)
- [ ] On-call and escalation procedures documented

### Technical Controls Verification
- [ ] MFA enabled for all admin accounts
- [ ] Secrets rotated within policy period
- [ ] Backup restoration tested
- [ ] Monitoring alerts functioning (test fire)
- [ ] Audit logs flowing to aggregation platform
```

### 7.3 Audit Evidence Repository

```
/compliance/evidence/
â”œâ”€â”€ access-control/
â”‚   â”œâ”€â”€ quarterly-access-reviews/
â”‚   â”‚   â”œâ”€â”€ 2026-Q1-review.md
â”‚   â”‚   â”œâ”€â”€ 2026-Q2-review.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ mfa-enforcement/
â”‚   â”‚   â””â”€â”€ screenshots/
â”‚   â”œâ”€â”€ rbac-configuration/
â”‚   â”‚   â””â”€â”€ rls-policies-export.sql
â”‚   â””â”€â”€ service-account-inventory.md
â”œâ”€â”€ vulnerability-management/
â”‚   â”œâ”€â”€ automated-scans/
â”‚   â”‚   â”œâ”€â”€ nuclei/
â”‚   â”‚   â”œâ”€â”€ zap/
â”‚   â”‚   â””â”€â”€ snyk/
â”‚   â”œâ”€â”€ penetration-tests/
â”‚   â”‚   â”œâ”€â”€ 2026-Q1-internal/
â”‚   â”‚   â”œâ”€â”€ 2026-Q3-external/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ remediation-tracking/
â”‚   â”‚   â””â”€â”€ vuln-tracker.csv
â”‚   â””â”€â”€ bug-bounty/
â”‚       â””â”€â”€ monthly-summaries/
â”œâ”€â”€ change-management/
â”‚   â”œâ”€â”€ sample-prs/
â”‚   â”œâ”€â”€ deployment-logs/
â”‚   â””â”€â”€ rollback-evidence/
â”œâ”€â”€ incident-response/
â”‚   â”œâ”€â”€ drills/
â”‚   â”‚   â”œâ”€â”€ 2026-H1-drill-report.md
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ incidents/
â”‚   â””â”€â”€ post-mortems/
â”œâ”€â”€ monitoring/
â”‚   â”œâ”€â”€ alert-configurations/
â”‚   â”œâ”€â”€ dashboard-screenshots/
â”‚   â””â”€â”€ log-retention-evidence/
â”œâ”€â”€ training/
â”‚   â”œâ”€â”€ security-awareness-completion/
â”‚   â””â”€â”€ onboarding-records/
â”œâ”€â”€ business-continuity/
â”‚   â”œâ”€â”€ dr-test-reports/
â”‚   â””â”€â”€ backup-restoration-evidence/
â””â”€â”€ vendor-management/
    â”œâ”€â”€ vendor-assessments/
    â”œâ”€â”€ dpas/
    â””â”€â”€ soc2-reports/  # Supabase, Vercel, Stripe SOC 2s
```

### 7.4 Continuous Compliance Monitoring

**Recommended Tool: Vanta or Drata**

These platforms provide:
- Automated evidence collection from GitHub, Vercel, Supabase, cloud providers
- Continuous control monitoring with automated alerts
- Gap identification dashboard
- Auditor collaboration portal
- Pre-built SOC 2, GDPR, CCPA frameworks

**Integration Points:**

| Data Source | Evidence Collected | Automation |
|-------------|-------------------|------------|
| GitHub | PR reviews, branch protection, code scanning alerts | API integration |
| Vercel | Deployment logs, environment config | API integration |
| Supabase | Auth settings, RLS policies | Manual + screenshots |
| Oracle Cloud | VPS config, network settings | Agent-based |
| Snyk | Vulnerability reports | Webhook integration |
| HackerOne | Bug bounty metrics, response SLAs | API integration |
| PagerDuty/Opsgenie | Incident tracking | API integration |

---

## 8. Vulnerability Management Lifecycle

### 8.1 Lifecycle Stages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
â”‚ DISCOVER â”‚â”€â”€>â”‚  TRIAGE  â”‚â”€â”€>â”‚PRIORITIZEâ”‚â”€â”€>â”‚REMEDIATE â”‚â”€â”€>â”‚  VERIFY  â”‚â”€â”€>â”‚ DOCUMENT â”‚
â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
â”‚ Sources: â”‚   â”‚ Validate â”‚   â”‚ Risk     â”‚   â”‚ Fix code â”‚   â”‚ Retest   â”‚   â”‚ Close    â”‚
â”‚ - Scans  â”‚   â”‚ Classify â”‚   â”‚ score    â”‚   â”‚ Deploy   â”‚   â”‚ Confirm  â”‚   â”‚ Update   â”‚
â”‚ - Pentestsâ”‚  â”‚ Assign   â”‚   â”‚ Schedule â”‚   â”‚ Hotfix?  â”‚   â”‚ Scan     â”‚   â”‚ metrics  â”‚
â”‚ - Bounty â”‚   â”‚ owner    â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
â”‚ - Researchâ”‚  â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚   â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Severity Classification & SLAs

| Severity | CVSS | Definition | Remediation SLA | Escalation |
|----------|------|-----------|----------------|------------|
| **P0 â€” Critical** | 9.0â€“10.0 | Active exploitation possible; data breach risk; complete system compromise | **72 hours** | Immediate â†’ Engineering lead â†’ Founder |
| **P1 â€” High** | 7.0â€“8.9 | Significant risk; requires attacker skill but achievable; customer data at risk | **14 days** | Day 1 â†’ Engineering lead. Day 7 â†’ Founder if unassigned |
| **P2 â€” Medium** | 4.0â€“6.9 | Moderate risk; requires specific conditions; limited blast radius | **30 days** | Day 14 â†’ Engineering lead if no progress |
| **P3 â€” Low** | 0.1â€“3.9 | Minor risk; informational; defense-in-depth improvements | **90 days** | Tracked in backlog, reviewed quarterly |
| **P4 â€” Informational** | 0.0 | Best practice recommendations; no direct exploit | **No SLA** | Documented for future sprints |

### 8.3 Vulnerability Tracking

#### Tracking Fields

| Field | Description | Example |
|-------|-------------|---------|
| `vuln_id` | Unique identifier | VULN-2026-042 |
| `title` | Descriptive title | SSRF in evidence collector via brand domain |
| `source` | Discovery method | Internal pentest Q1 2026 |
| `date_discovered` | When found | 2026-03-15 |
| `severity` | P0â€“P4 | P0 |
| `cvss_score` | CVSS 3.1 vector + score | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:N â€” 9.1 |
| `cwe_id` | CWE classification | CWE-918 |
| `affected_component` | File/service | `src/lib/evidence-collector.ts` |
| `status` | Current state | Open / In Progress / Fixed / Verified / Closed / Accepted Risk |
| `assigned_to` | Engineer responsible | @dev |
| `sla_due` | Fix deadline | 2026-03-18 |
| `fix_pr` | Pull request link | #142 |
| `date_fixed` | When deployed | 2026-03-17 |
| `date_verified` | When retest passed | 2026-03-18 |
| `risk_acceptance` | If accepted, who approved | N/A or "Approved by [Founder] on [date]" |
| `notes` | Additional context | Related to TD-001 in tech debt register |

#### Integration with Existing Tech Debt Register

The `TECH_DEBT_REGISTER.md` already tracks security items (TD-001 through TD-009). Going forward:
- Security vulnerabilities discovered through pentesting/scanning get `VULN-YYYY-NNN` IDs
- Tech debt items with security implications get cross-referenced
- Both feeds into the same prioritization framework
- Monthly reconciliation between VULN tracker and TD register

### 8.4 Risk Acceptance Process

For vulnerabilities that cannot be remediated within SLA:

```markdown
## Risk Acceptance Form

**Vulnerability:** [VULN-ID] â€” [Title]
**Severity:** [P0-P4] (CVSS: X.X)
**Affected Component:** [Component]

### Why It Can't Be Fixed Within SLA
[Detailed explanation â€” e.g., requires architectural change, dependency on vendor, 
acceptable residual risk with compensating controls]

### Compensating Controls
1. [Control 1 â€” e.g., WAF rule, monitoring alert, access restriction]
2. [Control 2]

### Residual Risk Assessment
[What remains exploitable even with compensating controls]

### Acceptance
- **Accepted by:** [Name, Title]
- **Date:** [YYYY-MM-DD]
- **Review Date:** [Maximum 90 days from acceptance]
- **Conditions:** [Any conditions for continued acceptance]

### Signature
Acknowledged and accepted: _______________
```

**Rules:**
- P0/P1 risk acceptance requires Founder approval
- P2 risk acceptance requires Engineering lead approval
- All risk acceptances reviewed quarterly
- Maximum acceptance period: 90 days (must re-evaluate)

---

## 9. Security Testing in CI/CD

### 9.1 Security Pipeline Architecture

```yaml
# .github/workflows/security-pipeline.yml
name: Security Pipeline

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main]
  schedule:
    - cron: '0 6 * * 1'  # Weekly scan

permissions:
  security-events: write
  contents: read
  pull-requests: write

jobs:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # STAGE 1: Static Analysis (runs on every PR)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  semgrep:
    name: Semgrep SAST
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: returntocorp/semgrep-action@v1
        with:
          config: >-
            .semgrep.yml
            p/typescript
            p/nextjs
            p/owasp-top-ten
            p/secrets
          generateSarif: "1"
      - uses: github/codeql-action/upload-sarif@v3
        if: always()
        with:
          sarif_file: semgrep.sarif

  eslint-security:
    name: ESLint Security
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npx eslint --config .eslintrc.security.json src/ --format json --output-file eslint-security.json
      - name: Check for security errors
        run: |
          ERRORS=$(cat eslint-security.json | jq '[.[].errorCount] | add')
          if [ "$ERRORS" -gt 0 ]; then
            echo "::error::ESLint security rules found $ERRORS errors"
            exit 1
          fi

  typescript-strict:
    name: TypeScript Strict Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - run: npx tsc --noEmit --strict

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # STAGE 2: Dependency & Container Security
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  dependency-audit:
    name: Dependency Audit
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      - run: npm ci
      - name: npm audit
        run: npm audit --audit-level=high --omit=dev
      - name: Snyk test
        uses: snyk/actions/node@master
        with:
          args: --severity-threshold=high
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

  secret-scan:
    name: Secret Detection
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: trufflesecurity/trufflehog@main
        with:
          extra_args: --only-verified --fail

  container-scan:
    name: Container Security
    runs-on: ubuntu-latest
    if: |
      contains(github.event.pull_request.labels.*.name, 'docker') ||
      github.event_name == 'push'
    steps:
      - uses: actions/checkout@v4
      - name: Build image
        run: docker build -t doppeldown-worker:scan .
      - uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'doppeldown-worker:scan'
          format: 'sarif'
          output: 'trivy-results.sarif'
          severity: 'CRITICAL,HIGH'
          exit-code: '1'
      - uses: github/codeql-action/upload-sarif@v3
        if: always()
        with:
          sarif_file: 'trivy-results.sarif'

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # STAGE 3: CodeQL Deep Analysis (PR + weekly)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  codeql:
    name: CodeQL Analysis
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: github/codeql-action/init@v3
        with:
          languages: javascript
          queries: security-extended
      - uses: github/codeql-action/analyze@v3

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # STAGE 4: Security Gate (blocks merge if any stage fails)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  security-gate:
    name: Security Gate
    needs: [semgrep, eslint-security, dependency-audit, secret-scan, container-scan, codeql]
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Check all security stages
        run: |
          if [[ "${{ needs.semgrep.result }}" == "failure" ]] || \
             [[ "${{ needs.eslint-security.result }}" == "failure" ]] || \
             [[ "${{ needs.dependency-audit.result }}" == "failure" ]] || \
             [[ "${{ needs.secret-scan.result }}" == "failure" ]] || \
             [[ "${{ needs.container-scan.result }}" == "failure" ]]; then
            echo "::error::Security gate FAILED â€” one or more security checks did not pass"
            exit 1
          fi
          echo "Security gate PASSED"
```

### 9.2 Branch Protection Rules

```yaml
# Required for main branch
branch_protection:
  required_reviews: 1
  dismiss_stale_reviews: true
  require_code_owner_reviews: true  # CODEOWNERS includes security-sensitive paths
  required_status_checks:
    strict: true
    contexts:
      - "Security Gate"
      - "Semgrep SAST"
      - "Dependency Audit"
      - "Secret Detection"
  enforce_admins: true
  allow_force_pushes: false
  allow_deletions: false
```

### 9.3 CODEOWNERS for Security-Sensitive Files

```
# .github/CODEOWNERS

# Security-critical files require security review
src/lib/ssrf-protection.ts     @security-team
src/lib/crypto.ts              @security-team
src/lib/rate-limit.ts          @security-team
src/lib/validation.ts          @security-team
src/middleware.ts               @security-team
supabase/schema.sql            @security-team
Dockerfile                      @security-team
docker-compose.yml             @security-team
.github/workflows/             @security-team
next.config.js                 @security-team  # Security headers
src/app/api/cron/              @security-team
src/app/api/stripe/            @security-team
src/lib/evidence-collector.ts  @security-team  # SSRF attack surface
scripts/scan-worker.ts         @security-team
```

---

## 10. Red Team Exercises

### 10.1 When to Start

**Prerequisites (all must be met):**
- [ ] All critical/high vulnerabilities from initial audit remediated
- [ ] External penetration test completed with clean report
- [ ] Bug bounty program running for 3+ months
- [ ] Incident response plan tested via tabletop exercise
- [ ] Security monitoring and alerting operational

**Estimated readiness:** Month 12â€“15 (Year 2)

### 10.2 Red Team Scenarios

#### Scenario 1: Phishing Operator Retaliation

**Narrative:** A phishing operator whose infrastructure was exposed by DoppelDown attempts to compromise the platform to:
1. Delete evidence against them
2. Identify which customer reported them
3. Disrupt DoppelDown's scanning capability

**Attack Vectors:**
- Craft a phishing/brand-impersonation site that exploits DoppelDown's evidence collector (SSRF, XSS via stored HTML)
- Register a typosquatting domain for DoppelDown itself
- Social engineering against DoppelDown team members
- Attempt to poison scan results with false positives

**Success Criteria (for defender):**
- Evidence collector does not execute attacker-controlled code
- Stored HTML is sandboxed and cannot access other customer data
- Team members follow phishing awareness protocols
- Scan result tampering detected and blocked

#### Scenario 2: Competitor Intelligence Theft

**Narrative:** A competitor attempts to extract DoppelDown's customer list, threat intelligence data, and AI analysis models.

**Attack Vectors:**
- API enumeration to discover customer brand names
- Authenticated user attempting to access other users' data via IDOR
- Leaked API keys from GitHub, error messages, or logs
- Social engineering to obtain trial/free accounts for reconnaissance

**Success Criteria (for defender):**
- No customer data accessible across account boundaries
- API responses do not leak other customers' information
- Rate limiting prevents enumeration
- Anomalous access patterns trigger alerts

#### Scenario 3: Supply Chain Attack

**Narrative:** An attacker compromises a dependency or third-party integration to inject malicious code.

**Attack Vectors:**
- Compromised npm package in dependency tree
- Malicious Supabase Edge Function
- Compromised CI/CD pipeline (GitHub Actions)
- DNS hijacking of API endpoints

**Success Criteria (for defender):**
- Dependency lockfile prevents unauthorized changes
- CI/CD has integrity checks and secret isolation
- DNS monitoring detects changes
- Subresource integrity where applicable

### 10.3 Red Team Engagement Structure

| Phase | Duration | Activities |
|-------|----------|-----------|
| **Planning** | 1 week | Define scenario, rules of engagement, success criteria, safety net |
| **Reconnaissance** | 1 week | OSINT, passive scanning, social media analysis, technology fingerprinting |
| **Initial Access** | 1â€“2 weeks | Attempt exploitation using scenario-specific vectors |
| **Post-Exploitation** | 1 week | Lateral movement, persistence, data exfiltration (simulated) |
| **Reporting** | 1 week | Detailed attack narrative, timeline, findings, defense gaps |
| **Purple Team Review** | 2 days | Joint attacker-defender review, playbook updates, control improvements |

---

## 11. Metrics, Reporting & KPIs

### 11.1 Key Performance Indicators

| KPI | Target | Measurement | Frequency |
|-----|--------|-------------|-----------|
| **Mean Time to Detect (MTTD)** | < 24 hours | Time from vulnerability introduction to discovery | Monthly |
| **Mean Time to Remediate (MTTR)** | < 14 days (high), < 72h (critical) | Time from triage to verified fix in production | Monthly |
| **Vulnerability Backlog Age** | 0 items > SLA | Count of open vulnerabilities exceeding remediation SLA | Weekly |
| **Scan Coverage** | 100% of deployments | Percentage of deployments with all Layer 1-3 scans passing | Per deployment |
| **Dependency Vulnerability Count** | 0 critical, < 5 high | Open dependency vulnerabilities by severity | Weekly |
| **Bug Bounty Response SLA** | > 95% within SLA | Percentage of reports triaged within stated SLA | Monthly |
| **False Positive Rate** | < 15% | Percentage of automated findings marked as false positive | Monthly |
| **Security Debt Ratio** | < 10% of total debt | Security items as percentage of total tech debt | Quarterly |
| **Pentest Finding Trend** | Decreasing Q/Q | Number of unique findings per quarterly pentest | Quarterly |
| **Time to Patch Dependencies** | < 7 days (critical) | Time from CVE publication to patched version deployed | Per CVE |

### 11.2 Reporting Cadence

| Report | Audience | Frequency | Content |
|--------|----------|-----------|---------|
| **Security Dashboard** | Engineering team | Real-time | Open vulns, scan status, SLA status, recent findings |
| **Weekly Security Digest** | Engineering lead | Weekly | New findings, SLA breaches, remediation progress, scan results |
| **Monthly Security Report** | Founder / stakeholders | Monthly | KPI trends, risk posture, program metrics, notable events |
| **Quarterly Security Review** | All stakeholders | Quarterly | Pentest results, program effectiveness, roadmap updates, budget review |
| **Annual Security Report** | Board / investors | Annually | Year-in-review, compliance status, pentest summary, program maturity |

### 11.3 Security Maturity Model

Track progress against a simplified maturity model:

| Capability | Level 1 (Initial) | Level 2 (Developing) | Level 3 (Defined) | Level 4 (Managed) | Level 5 (Optimizing) |
|------------|-------------------|---------------------|-------------------|-------------------|---------------------|
| **Vulnerability Scanning** | Ad hoc | Automated CI scans | Full pipeline + scheduled | Continuous + custom rules | ML-assisted prioritization |
| **Penetration Testing** | Never done | Annual external | Quarterly internal + annual external | Continuous + red team | Adversary emulation program |
| **Bug Bounty** | No program | Responsible disclosure page | Private program | Public program | Integrated with development |
| **Vulnerability Management** | No tracking | Spreadsheet tracking | Formal lifecycle with SLAs | Automated tracking + metrics | Predictive analytics |
| **Security in CI/CD** | No gates | Basic lint + audit | Multi-stage pipeline | Security gate blocks deploy | Automated fix suggestions |
| **Compliance** | Unaware | Aware of requirements | Policies documented | Controls evidenced + monitored | Continuous compliance |

**Current State:** Level 1 across all capabilities  
**6-Month Target:** Level 2â€“3  
**12-Month Target:** Level 3â€“4  
**18-Month Target:** Level 4  

---

## 12. Tooling Stack

### 12.1 Recommended Security Tool Stack

| Category | Tool | Purpose | Cost | Priority |
|----------|------|---------|------|----------|
| **SAST** | Semgrep (OSS) | Pattern-based static analysis | Free (OSS) | P0 â€” Implement immediately |
| **SAST (Deep)** | GitHub CodeQL | Dataflow analysis | Free for public repos / $49/dev/mo | P1 â€” Month 1 |
| **SCA** | Snyk | Dependency + license scanning | Free tier / $25/dev/mo | P0 â€” Implement immediately |
| **SCA** | Dependabot | Automated dependency PRs | Free (GitHub native) | P0 â€” Enable today |
| **Container** | Trivy | Container image scanning | Free (OSS) | P1 â€” Month 1 |
| **DAST** | OWASP ZAP | Web application scanning | Free (OSS) | P1 â€” Month 2 |
| **DAST** | Nuclei | Template-based vulnerability scanning | Free (OSS) | P1 â€” Month 2 |
| **Secret Detection** | TruffleHog | Secret scanning in git history | Free (OSS) | P0 â€” Implement immediately |
| **Secret Detection** | GitHub Secret Scanning | Push protection | Free (included) | P0 â€” Enable today |
| **Bug Bounty** | HackerOne | Managed bug bounty platform | ~$500/mo + bounties | P2 â€” Month 6 |
| **Compliance** | Vanta or Drata | SOC 2 automation | $10Kâ€“$25K/yr | P2 â€” Month 4 |
| **Monitoring** | Sentry | Error tracking + alerting | Free tier / $26/mo | P1 â€” Month 1 |
| **Log Aggregation** | Axiom | Centralized logging | Free tier / $25/mo | P1 â€” Month 2 |
| **Incident Management** | PagerDuty or Opsgenie | On-call + incident tracking | Free tier / $9â€“$29/user/mo | P2 â€” Month 4 |
| **Secrets Management** | Doppler or 1Password | Centralized secrets with rotation | $4â€“$15/user/mo | P2 â€” Month 3 |

### 12.2 Cost Summary (Year 1)

| Category | Monthly | Annual |
|----------|---------|--------|
| Free/OSS tools (Semgrep, Trivy, ZAP, Nuclei, TruffleHog) | $0 | $0 |
| Snyk (Team plan, 2 developers) | $50 | $600 |
| Sentry (Team plan) | $26 | $312 |
| Axiom (Starter) | $25 | $300 |
| HackerOne platform (Month 6+) | $500 | $3,500 |
| Bug bounty payouts (Month 6+) | $3,000 | $21,000 |
| Vanta/Drata (Month 4+) | $1,500 | $13,500 |
| External pentest (annual) | â€” | $20,000 |
| PagerDuty (2 users) | $40 | $480 |
| Doppler (Team) | $20 | $240 |
| **Total** | **~$5,161** | **~$59,932** |

*Note: Bug bounty payouts are highly variable. Budget assumes moderate program activity.*

---

## 13. Budget & Resource Planning

### 13.1 Year 1 Investment Summary

| Category | Q1 | Q2 | Q3 | Q4 | Total |
|----------|-----|-----|-----|-----|-------|
| **Tooling (SaaS)** | $400 | $2,800 | $4,700 | $4,700 | $12,600 |
| **Bug Bounty Payouts** | â€” | â€” | $6,000 | $9,000 | $15,000 |
| **External Pentest** | â€” | â€” | $20,000 | â€” | $20,000 |
| **Compliance Platform** | â€” | $4,500 | $4,500 | $4,500 | $13,500 |
| **Engineering Time** Â¹ | 80 hrs | 60 hrs | 40 hrs | 40 hrs | 220 hrs |
| **Legal (DPAs, policies)** | $5,000 | â€” | â€” | â€” | $5,000 |
| **SOC 2 Type I Audit** | â€” | â€” | â€” | $20,000 | $20,000 |
| **Training** | $500 | â€” | â€” | $500 | $1,000 |
| **Total Cash** | **$5,900** | **$7,300** | **$35,200** | **$38,700** | **$87,100** |

Â¹ *Engineering time valued at opportunity cost, not cash outlay if done in-house.*

### 13.2 Year 2 Steady-State Budget

| Category | Annual |
|----------|--------|
| Security tooling (SaaS subscriptions) | $15,000 |
| Bug bounty (platform + payouts) | $40,000 |
| Annual external pentest | $20,000 |
| SOC 2 Type II audit | $35,000 |
| Compliance platform | $15,000 |
| Training | $2,000 |
| Engineering time (ongoing security work) | 160 hrs |
| **Total** | **~$127,000** |

### 13.3 ROI Justification

| Risk Avoided | Potential Cost Without Program | Annual Program Cost |
|-------------|-------------------------------|-------------------|
| Data breach (customer threat intelligence) | $200Kâ€“$2M (notification, legal, churn) | â€” |
| GDPR fine (non-compliance) | â‚¬20M or 4% turnover | â€” |
| Lost enterprise deals (no SOC 2) | $50Kâ€“$500K/year in missed revenue | â€” |
| Reputational damage (security product gets hacked) | Existential (brand destruction) | â€” |
| **Total Risk Mitigation** | **$250Kâ€“$2.5M+** | **~$87K (Y1) / ~$127K (Y2)** |

---

## 14. Phased Implementation Roadmap

### 14.1 Visual Roadmap

```
2026
Feb         Mar         Apr         May         Jun         Jul
 â”‚           â”‚           â”‚           â”‚           â”‚           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                              
 â”‚ PHASE 0   â”‚ Enable free tooling: Dependabot, GitHub      
 â”‚ IMMEDIATE â”‚ Secret Scanning, npm audit in CI, TruffleHog 
 â”‚ (Week 1-2)â”‚ pre-commit hook. Fix SSRF, DB grants, timing.
 â”‚           â”‚                                              
 â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  
 â”‚           â”‚ PHASE 1   â”‚ Full CI/CD security pipeline:    
 â”‚           â”‚ FOUNDATIONâ”‚ Semgrep, CodeQL, Snyk, Trivy.    
 â”‚           â”‚ (Wk 3-8)  â”‚ Security headers. Rate limiting. 
 â”‚           â”‚           â”‚ Input validation. Docker hardening.
 â”‚           â”‚           â”‚                                  
 â”‚           â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              
 â”‚           â”‚           â”‚ PHASE 2           â”‚ Scheduled    
 â”‚           â”‚           â”‚ SCHEDULED SCANNINGâ”‚ scans: weekly
 â”‚           â”‚           â”‚ (Wk 9-16)        â”‚ Nuclei,      
 â”‚           â”‚           â”‚                  â”‚ monthly ZAP.  
 â”‚           â”‚           â”‚                  â”‚ Asset discover.
 â”‚           â”‚           â”‚                  â”‚ Vuln tracking.
 â”‚           â”‚           â”‚                  â”‚              
 â”‚           â”‚           â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
 â”‚           â”‚           â”‚     â”‚ PHASE 3    â”‚           â”‚  
 â”‚           â”‚           â”‚     â”‚ MANUAL     â”‚ Q1 pentestâ”‚  
 â”‚           â”‚           â”‚     â”‚ TESTING    â”‚ + start   â”‚  
 â”‚           â”‚           â”‚     â”‚ (Wk 12-20)â”‚ quarterly â”‚  
 â”‚           â”‚           â”‚     â”‚           â”‚ cadence   â”‚  
 â”‚           â”‚           â”‚     â”‚           â”‚           â”‚  

Jul         Aug         Sep         Oct         Nov         Dec
 â”‚           â”‚           â”‚           â”‚           â”‚           â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                  
 â”‚ PHASE 4               â”‚ Private bug bounty on HackerOne.
 â”‚ BUG BOUNTY LAUNCH     â”‚ 20-30 vetted researchers.       
 â”‚ (Wk 20-28)            â”‚ Validate processes & SLAs.      
 â”‚                        â”‚                                  
 â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      
 â”‚           â”‚ PHASE 5               â”‚ External pentest.    
 â”‚           â”‚ EXTERNAL PENTEST      â”‚ Full scope against   
 â”‚           â”‚ (Wk 28-36)            â”‚ staging environment. 
 â”‚           â”‚                        â”‚ SOC 2 evidence.     
 â”‚           â”‚                        â”‚                      
 â”‚           â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
 â”‚           â”‚           â”‚ PHASE 6                        â”‚  
 â”‚           â”‚           â”‚ AUDIT PREP + SOC 2 TYPE I      â”‚  
 â”‚           â”‚           â”‚ (Wk 36-48)                     â”‚  
 â”‚           â”‚           â”‚ Evidence collection, mock audit,â”‚  
 â”‚           â”‚           â”‚ Type I engagement.              â”‚  
 â”‚           â”‚           â”‚                                  
 â”‚           â”‚           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 â”‚           â”‚           â”‚                    â”‚ PHASE 7     
 â”‚           â”‚           â”‚                    â”‚ STEADY STATE
 â”‚           â”‚           â”‚                    â”‚ (Wk 48+)   
 â”‚           â”‚           â”‚                    â”‚ Continuous  
 â”‚           â”‚           â”‚                    â”‚ operation.  
```

### 14.2 Detailed Phase Breakdown

#### Phase 0: Immediate Actions (Weeks 1â€“2) â€” Cost: $0

| # | Action | Time | Owner | Deliverable |
|---|--------|------|-------|-------------|
| 0.1 | Enable GitHub Dependabot | 30 min | DevOps | `.github/dependabot.yml` |
| 0.2 | Enable GitHub Secret Scanning + Push Protection | 15 min | DevOps | Repository settings |
| 0.3 | Add `npm audit --audit-level=high` to CI | 30 min | DevOps | GitHub Actions workflow |
| 0.4 | Install TruffleHog pre-commit hook | 30 min | Dev | `.pre-commit-config.yaml` |
| 0.5 | Fix SSRF vulnerability (VULN-C1 / TD-001) | 4 hrs | Dev | `ssrf-protection.ts` |
| 0.6 | Fix DB grant overprivilege (VULN-C2) | 2 hrs | Dev | Updated `schema.sql` |
| 0.7 | Fix timing attack in cron auth (VULN-C3) | 30 min | Dev | Updated cron routes |
| 0.8 | Add security headers to `next.config.js` (MIT-S1) | 2 hrs | Dev | Updated `next.config.js` |
| 0.9 | Create `security@doppeldown.com` alias | 15 min | Admin | Security contact email |
| 0.10 | Publish basic `security.txt` at `/.well-known/security.txt` | 15 min | Dev | Security contact file |

**`security.txt` template:**
```
Contact: mailto:security@doppeldown.com
Expires: 2027-02-05T00:00:00.000Z
Preferred-Languages: en
Canonical: https://doppeldown.com/.well-known/security.txt
Policy: https://doppeldown.com/security/disclosure
```

#### Phase 1: Foundation (Weeks 3â€“8) â€” Cost: ~$400

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 1.1 | Build full CI/CD security pipeline (Â§9.1) | 2 days | `.github/workflows/security-pipeline.yml` |
| 1.2 | Configure Semgrep with DoppelDown-specific rules | 4 hrs | `.semgrep.yml` |
| 1.3 | Set up CodeQL analysis | 2 hrs | `.github/workflows/codeql-analysis.yml` |
| 1.4 | Sign up for Snyk, integrate with GitHub | 2 hrs | Snyk project |
| 1.5 | Set up Trivy for Docker image scanning | 2 hrs | CI workflow step |
| 1.6 | Implement input validation (Zod schemas) | 4 hrs | `src/lib/validation.ts` |
| 1.7 | Implement rate limiting | 4 hrs | `src/lib/rate-limit.ts` |
| 1.8 | Docker security hardening (non-root, sandbox) | 2 hrs | Updated `Dockerfile` |
| 1.9 | Strengthen password policy (min 8 chars, NIST 800-63b) | 1 hr | Updated auth pages |
| 1.10 | Set up Sentry for error tracking | 2 hrs | Sentry project + SDK |
| 1.11 | Configure branch protection rules | 1 hr | GitHub settings |
| 1.12 | Set up CODEOWNERS for security files | 30 min | `.github/CODEOWNERS` |
| 1.13 | Create vulnerability tracking spreadsheet/board | 2 hrs | GitHub Projects board |

#### Phase 2: Scheduled Scanning (Weeks 9â€“16) â€” Cost: ~$400

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 2.1 | Set up weekly Nuclei scanning | 4 hrs | CI cron workflow + custom templates |
| 2.2 | Set up monthly ZAP full scan | 4 hrs | CI cron workflow + context file |
| 2.3 | Set up monthly asset discovery | 2 hrs | Scanning scripts |
| 2.4 | Set up Axiom for log aggregation | 4 hrs | Axiom project + integrations |
| 2.5 | Configure security alerting (scan results â†’ notifications) | 4 hrs | Alert rules |
| 2.6 | Establish vulnerability management lifecycle (Â§8) | 1 day | Documented process |
| 2.7 | Set up security metrics dashboard | 4 hrs | Dashboard (GitHub Projects / Notion) |
| 2.8 | Deploy header and TLS verification scripts | 2 hrs | Deploy-time CI steps |
| 2.9 | First monthly security report | 4 hrs | Report template + first report |

#### Phase 3: Manual Testing (Weeks 12â€“20) â€” Cost: ~$0 (internal)

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 3.1 | Conduct Q1 internal pentest: Auth & Access Control | 2 weeks | Internal pentest report |
| 3.2 | Document all test procedures per Â§5.2 | 1 week | Test procedure library |
| 3.3 | Remediate pentest findings | 2 weeks | Fix PRs + verification |
| 3.4 | Establish quarterly pentest cadence | 2 hrs | Calendar invites + process doc |
| 3.5 | Conduct first incident response tabletop exercise | 4 hrs | IR drill report |

#### Phase 4: Bug Bounty Launch (Weeks 20â€“28) â€” Cost: ~$4,000â€“$8,000

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 4.1 | Write responsible disclosure policy | 4 hrs | Published policy page |
| 4.2 | Set up HackerOne program (private) | 1 day | HackerOne project |
| 4.3 | Define scope, rewards, and rules (Â§6) | 4 hrs | Program brief |
| 4.4 | Invite 20â€“30 vetted researchers | 2 hrs | Researcher invitations |
| 4.5 | Establish triage process and rotation | 4 hrs | Triage runbook |
| 4.6 | Monitor and iterate on program for 8 weeks | Ongoing | Monthly program review |

#### Phase 5: External Pentest (Weeks 28â€“36) â€” Cost: ~$20,000

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 5.1 | Select pentest vendor (Â§5.3.2) | 2 weeks | Engagement letter |
| 5.2 | Prepare staging environment + test accounts | 1 week | Staging setup |
| 5.3 | Execute external penetration test | 3â€“4 weeks | Pentest report |
| 5.4 | Remediate findings | 4 weeks | Fix PRs + verification |
| 5.5 | Schedule vendor retest | 1 week | Retest report |
| 5.6 | Archive reports for SOC 2 evidence | 2 hrs | Evidence repository |

#### Phase 6: Audit Prep & SOC 2 Type I (Weeks 36â€“48) â€” Cost: ~$20,000â€“$35,000

| # | Action | Time | Deliverable |
|---|--------|------|-------------|
| 6.1 | Set up Vanta/Drata compliance platform | 1 week | Platform configured |
| 6.2 | Run pre-audit checklist (Â§7.2) | 1 week | Checklist completed |
| 6.3 | Collect all evidence (Â§7.3) | 2 weeks | Evidence repository populated |
| 6.4 | Conduct internal mock audit | 1 week | Mock audit report |
| 6.5 | Remediate mock audit findings | 2 weeks | Fixes deployed |
| 6.6 | Engage SOC 2 auditor | 2 weeks | Audit engagement |
| 6.7 | Complete SOC 2 Type I audit | 2 weeks | Type I report |

#### Phase 7: Steady State (Week 48+) â€” Ongoing

- Continuous automated scanning (all 4 layers)
- Quarterly internal penetration tests
- Annual external penetration test
- Always-on bug bounty program
- Monthly security reports
- Quarterly security reviews
- Annual SOC 2 Type II audit
- Semi-annual incident response drills
- Quarterly DR tests
- Annual vendor security assessments
- Continuous compliance monitoring via Vanta/Drata

---

## 15. Appendices

### Appendix A: OWASP Top 10 (2021) Testing Checklist

| # | Category | Test Coverage | DoppelDown Relevance |
|---|----------|-------------|---------------------|
| A01 | Broken Access Control | Q1 pentest (Auth focus) + automated IDOR checks | **CRITICAL** â€” Multi-tenant SaaS with tier-based access |
| A02 | Cryptographic Failures | Quarterly config audit + TLS checks | **HIGH** â€” Evidence encryption, API key protection |
| A03 | Injection | Semgrep rules + Q2 pentest + ZAP active scan | **HIGH** â€” User inputs (brand names, domains, keywords) |
| A04 | Insecure Design | Threat modeling + Q2 business logic pentest | **HIGH** â€” Scan engine, evidence collection design |
| A05 | Security Misconfiguration | Nuclei templates + header checks + config audit | **HIGH** â€” Docker, Supabase, Vercel, VPS configs |
| A06 | Vulnerable and Outdated Components | Snyk + Dependabot + npm audit + Trivy | **MEDIUM** â€” Puppeteer + Chrome are high-risk deps |
| A07 | Identification and Authentication Failures | Q1 pentest + Semgrep + ZAP | **CRITICAL** â€” Auth is foundation of all access control |
| A08 | Software and Data Integrity Failures | CI/CD pipeline security + dependency lockfiles | **MEDIUM** â€” Build pipeline not yet established |
| A09 | Security Logging and Monitoring Failures | Log aggregation setup + audit log enhancement | **HIGH** â€” Currently minimal logging |
| A10 | Server-Side Request Forgery (SSRF) | Custom Semgrep rules + Q3 pentest + Nuclei | **CRITICAL** â€” Evidence collector is primary SSRF surface |

### Appendix B: Pentest Finding Template

```markdown
# [VULN-YYYY-NNN] â€” [Vulnerability Title]

## Summary
[One-paragraph description of the vulnerability]

## Severity
- **Rating:** [Critical / High / Medium / Low / Informational]
- **CVSS 3.1:** [Vector string] â€” [Score]
- **CWE:** [CWE-XXX] â€” [CWE Name]

## Affected Component
- **File(s):** [file path(s)]
- **Endpoint:** [API route or URL]
- **Environment:** [Production / Staging / Both]

## Description
[Detailed technical description of the vulnerability, including root cause]

## Proof of Concept
[Step-by-step reproduction instructions]

```
[Code, HTTP requests, or commands used]
```

## Impact
[What an attacker could achieve by exploiting this vulnerability]

## Remediation
### Recommended Fix
[Specific technical guidance for fixing the issue]

```[language]
[Code example of the fix]
```

### Alternative Mitigations
[If immediate fix isn't possible, what compensating controls can reduce risk]

## References
- [OWASP page]
- [CWE page]
- [Related CVEs or research]

## Metadata
| Field | Value |
|-------|-------|
| Discovered by | [Name] |
| Discovery method | [Pentest / Scan / Bug Bounty / Research] |
| Date discovered | [YYYY-MM-DD] |
| Date reported | [YYYY-MM-DD] |
| SLA due date | [YYYY-MM-DD] |
| Assigned to | [Engineer] |
| Status | [Open / In Progress / Fixed / Verified / Closed] |
| Fix PR | [Link] |
| Date fixed | [YYYY-MM-DD] |
| Verified by | [Name] |
| Date verified | [YYYY-MM-DD] |
```

### Appendix C: Security Testing Environment Setup

```markdown
## Staging Environment for Security Testing

### Requirements
1. Production-equivalent staging deployment on Vercel
2. Separate Supabase project with test data (no production data)
3. Stripe test mode integration
4. Test user accounts at each subscription tier
5. Seeded brand + threat data for testing access controls
6. Scan worker running against staging Supabase

### Test Account Matrix
| Role | Email | Tier | Purpose |
|------|-------|------|---------|
| Free User | test-free@doppeldown.com | Free | Tier limit testing |
| Starter User | test-starter@doppeldown.com | Starter | Mid-tier testing |
| Pro User | test-pro@doppeldown.com | Professional | High-tier testing |
| Enterprise User | test-enterprise@doppeldown.com | Enterprise | Full-feature testing |
| Admin User | test-admin@doppeldown.com | Admin | Privilege testing |
| Attacker User | test-attacker@doppeldown.com | Free | Cross-account testing |

### Data Isolation
- Staging uses completely separate database
- No production credentials stored in staging env
- Staging data reset weekly (automated)
- No real customer data used in testing
```

### Appendix D: Incident Response Integration

When a security test discovers an actively-exploitable vulnerability in production:

```
1. STOP testing immediately (don't make it worse)
2. Document the finding with screenshot/recording
3. Classify severity (use CVSS calculator)
4. If P0 (Critical): 
   a. Notify engineering lead IMMEDIATELY (phone/Signal)
   b. Implement emergency mitigation (WAF rule, feature flag, endpoint disable)
   c. Verify mitigation effective
   d. Begin full remediation within 24 hours
5. If P1 (High):
   a. File vulnerability report with full details
   b. Notify engineering lead within 4 hours
   c. Begin remediation within 48 hours
6. For all severities:
   a. Do NOT disclose to external parties until fixed
   b. Check if vulnerability has been exploited (log review)
   c. If exploitation detected â†’ trigger full Incident Response Plan
```

### Appendix E: Compliance Mapping

| Security Testing Activity | SOC 2 Control | GDPR Article | CCPA Section |
|--------------------------|---------------|-------------|-------------|
| Automated vulnerability scanning | CC7.1 | Art. 32(1)(d) | Â§1798.100 |
| Penetration testing | CC7.1, CC3.1 | Art. 32(1)(d) | â€” |
| Bug bounty program | CC7.1, CC2.3 | Art. 32(1)(d) | â€” |
| Vulnerability remediation | CC7.1, CC7.4 | Art. 32(1)(d) | â€” |
| Security monitoring | CC7.2, CC4.1 | Art. 32(1)(d) | â€” |
| Incident detection | CC7.2, CC7.3 | Art. 33, 34 | Â§1798.150 |
| Access control testing | CC6.1â€“CC6.3 | Art. 32(1)(b) | â€” |
| Data protection testing | CC6.7, C1.1 | Art. 32(1)(a) | Â§1798.100 |
| Change management verification | CC8.1 | Art. 32(1)(d) | â€” |
| Vendor security assessment | CC9.2 | Art. 28 | Â§1798.140 |

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-02-05 | OpenClaw Security Subagent | Initial strategy document |

**Review Schedule:**
- Quarterly review of scanning configurations and pentest results
- Annual review of full strategy, budget, and tooling
- Ad-hoc review after any P0 incident or major architecture change

**Approval:**
- [ ] Engineering Lead
- [ ] Founder / CEO

---

*This document is confidential and intended for DoppelDown internal use only. The penetration testing scope, vulnerability details, and security architecture information contained herein must not be shared externally without written approval.*
