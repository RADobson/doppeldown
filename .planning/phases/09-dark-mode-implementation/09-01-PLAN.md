---
phase: 09-dark-mode-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/theme-provider.tsx
  - src/app/layout.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Dark mode respects system preference on first visit"
    - "User preference persists across sessions"
    - "No flash of incorrect theme on page load"
  artifacts:
    - path: "src/components/theme-provider.tsx"
      provides: "Client wrapper for next-themes"
      exports: ["ThemeProvider"]
    - path: "src/app/globals.css"
      provides: "Dark mode CSS variables"
      contains: ".dark {"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/theme-provider.tsx"
      via: "ThemeProvider wrapper"
      pattern: "ThemeProvider"
    - from: "src/app/globals.css"
      to: "tailwind.config.ts"
      via: "CSS variable references"
      pattern: "--background|--foreground|--card"
---

<objective>
Install next-themes and configure dark mode infrastructure

Purpose: Enable theming capability with system preference detection, localStorage persistence, and FOUC prevention
Output: ThemeProvider wrapper, root layout integration, dark mode CSS variables
</objective>

<execution_context>
@/home/dobsondev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dobsondev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-dark-mode-implementation/09-RESEARCH.md

@src/app/globals.css
@src/app/layout.tsx
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install next-themes and create ThemeProvider</name>
  <files>
    package.json
    src/components/theme-provider.tsx
  </files>
  <action>
    1. Install next-themes:
       `npm install next-themes`

    2. Create ThemeProvider client wrapper at src/components/theme-provider.tsx:
       - "use client" directive (required for next-themes)
       - Import ThemeProvider as NextThemesProvider from next-themes
       - Re-export wrapped component that passes through all props
       - Use React.ComponentProps<typeof NextThemesProvider> for type safety

    Pattern from research:
    ```typescript
    "use client"

    import * as React from "react"
    import { ThemeProvider as NextThemesProvider } from "next-themes"

    export function ThemeProvider({
      children,
      ...props
    }: React.ComponentProps<typeof NextThemesProvider>) {
      return <NextThemesProvider {...props}>{children}</NextThemesProvider>
    }
    ```
  </action>
  <verify>
    - npm ls next-themes shows installed
    - src/components/theme-provider.tsx exists with "use client" directive
  </verify>
  <done>next-themes installed, ThemeProvider wrapper component created</done>
</task>

<task type="auto">
  <name>Task 2: Update root layout with ThemeProvider</name>
  <files>
    src/app/layout.tsx
  </files>
  <action>
    Modify src/app/layout.tsx:

    1. Import ThemeProvider from "@/components/theme-provider"

    2. Add suppressHydrationWarning to <html> tag (prevents React hydration warnings)

    3. Wrap {children} with ThemeProvider inside <body>:
       - attribute="class" (Tailwind uses .dark class)
       - defaultTheme="system" (respects OS preference - DARK-02)
       - enableSystem (detects prefers-color-scheme)
       - disableTransitionOnChange (prevents staggered transitions - DARK-06)

    Keep existing:
    - Metadata export
    - Inter font import and className on body
    - All existing metadata

    Result structure:
    ```tsx
    <html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider
          attribute="class"
          defaultTheme="system"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
    ```
  </action>
  <verify>
    - src/app/layout.tsx has suppressHydrationWarning on html tag
    - ThemeProvider wraps children with correct props
    - npm run build succeeds
  </verify>
  <done>Root layout configured with ThemeProvider, system preference enabled</done>
</task>

<task type="auto">
  <name>Task 3: Add dark mode CSS variables</name>
  <files>
    src/app/globals.css
  </files>
  <action>
    Add .dark {} block inside @layer base with dark mode token values.

    Dark mode palette (Material Design #121212 base):
    - --background: 222.2 84% 4.9% (dark gray base ~#0a0a0f)
    - --foreground: 210 40% 98% (near-white text)
    - --card: 217.2 32.6% 12% (elevated surface, slightly lighter than bg)
    - --card-foreground: 210 40% 98%
    - --muted: 217.2 32.6% 17.5% (subtle backgrounds)
    - --muted-foreground: 215 20.2% 65.1% (secondary text - must pass 4.5:1 contrast)
    - --accent: 217.2 32.6% 17.5% (hover states)
    - --accent-foreground: 210 40% 98%
    - --destructive: 0 62.8% 50.6% (slightly muted red for dark mode)
    - --destructive-foreground: 0 0% 98%
    - --border: 217.2 32.6% 20% (visible but subtle borders)
    - --input: 217.2 32.6% 17.5%
    - --ring: 212.7 26.8% 83.9% (lighter ring for visibility)
    - --primary: 217.2 91.2% 59.8% (slightly brighter blue for dark mode)
    - --primary-foreground: 222.2 47.4% 11.2%
    - --scrollbar-track: 217.2 32.6% 12%
    - --scrollbar-thumb: 215 20.2% 35%
    - --scrollbar-thumb-hover: 215 20.2% 45%

    IMPORTANT: Do NOT change --landing-* tokens in .dark block.
    Landing page tokens stay the same (THEME-LANDING-01 decision).

    Add transition utility for smooth theme changes (after @layer base):
    ```css
    * {
      @apply transition-colors duration-200;
    }
    ```

    Note: disableTransitionOnChange in ThemeProvider will temporarily disable this during toggle to prevent staggered animations.
  </action>
  <verify>
    - .dark {} block exists in globals.css
    - Dark mode variables defined with HSL values
    - No changes to --landing-* tokens
    - npm run build succeeds
  </verify>
  <done>Dark mode CSS variables configured with WCAG-compliant colors</done>
</task>

</tasks>

<verification>
1. npm run build succeeds without errors
2. npm run dev starts successfully
3. Manual test: Open browser DevTools, add "dark" class to <html> element
   - Page background should change to dark gray
   - Text should change to near-white
   - Removing "dark" class reverts to light mode
4. localStorage check: Refresh page, theme preference should persist
</verification>

<success_criteria>
- next-themes installed and ThemeProvider wrapper exists
- Root layout uses ThemeProvider with system preference enabled
- Dark mode CSS variables defined with proper contrast ratios
- No FOUC (flash of unstyled content) on page load
- Theme persists across browser refresh
</success_criteria>

<output>
After completion, create `.planning/phases/09-dark-mode-implementation/09-01-SUMMARY.md`
</output>
