---
phase: 09-dark-mode-implementation
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/theme-toggle.tsx
  - src/app/dashboard/layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between light and dark modes via header control"
    - "Toggle shows three options: Light, Dark, System"
    - "Current theme selection is visually indicated"
  artifacts:
    - path: "src/components/theme-toggle.tsx"
      provides: "Theme toggle dropdown component"
      exports: ["ThemeToggle"]
    - path: "src/app/dashboard/layout.tsx"
      provides: "Header with theme toggle"
      contains: "ThemeToggle"
  key_links:
    - from: "src/components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme"
    - from: "src/app/dashboard/layout.tsx"
      to: "src/components/theme-toggle.tsx"
      via: "component import"
      pattern: "ThemeToggle"
---

<objective>
Create theme toggle UI and integrate into dashboard header

Purpose: Provide manual theme switching capability (DARK-01) with three-way choice for optimal UX
Output: ThemeToggle dropdown component, header integration
</objective>

<execution_context>
@/home/dobsondev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dobsondev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-dark-mode-implementation/09-RESEARCH.md
@.planning/phases/09-dark-mode-implementation/09-01-SUMMARY.md

@src/components/NotificationDropdown.tsx
@src/app/dashboard/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemeToggle component</name>
  <files>
    src/components/theme-toggle.tsx
  </files>
  <action>
    Create src/components/theme-toggle.tsx with three-way theme selection dropdown.

    Pattern to follow (matching NotificationDropdown style):
    - "use client" directive
    - Import useTheme from next-themes
    - Import Sun, Moon, Monitor icons from lucide-react
    - Use useState for dropdown open state
    - Use useRef + useEffect for click-outside handling
    - Use mounted state guard to prevent hydration mismatch

    Structure:
    ```typescript
    "use client"

    import { useState, useRef, useEffect } from 'react'
    import { useTheme } from 'next-themes'
    import { Sun, Moon, Monitor, Check } from 'lucide-react'
    import { cn } from '@/lib/utils'

    export function ThemeToggle() {
      const [mounted, setMounted] = useState(false)
      const [isOpen, setIsOpen] = useState(false)
      const { theme, setTheme, resolvedTheme } = useTheme()
      const dropdownRef = useRef<HTMLDivElement>(null)

      // Prevent hydration mismatch
      useEffect(() => {
        setMounted(true)
      }, [])

      // Click outside handler (same pattern as NotificationDropdown)
      useEffect(() => {
        function handleClickOutside(event: MouseEvent) {
          if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
            setIsOpen(false)
          }
        }
        if (isOpen) {
          document.addEventListener('mousedown', handleClickOutside)
          return () => document.removeEventListener('mousedown', handleClickOutside)
        }
      }, [isOpen])

      // Don't render anything until mounted (prevents hydration mismatch)
      if (!mounted) {
        return <div className="w-9 h-9" /> // Placeholder to prevent layout shift
      }

      const options = [
        { value: 'light', label: 'Light', icon: Sun },
        { value: 'dark', label: 'Dark', icon: Moon },
        { value: 'system', label: 'System', icon: Monitor },
      ]

      return (
        <div className="relative" ref={dropdownRef}>
          {/* Toggle button - shows current resolved theme icon */}
          <button
            onClick={() => setIsOpen(!isOpen)}
            className="p-2 text-muted-foreground hover:text-foreground rounded-lg hover:bg-accent"
            aria-label="Toggle theme"
          >
            {resolvedTheme === 'dark' ? (
              <Moon className="h-5 w-5" />
            ) : (
              <Sun className="h-5 w-5" />
            )}
          </button>

          {/* Dropdown menu */}
          {isOpen && (
            <div className="absolute right-0 mt-2 w-36 bg-card rounded-lg shadow-lg border border-border z-50 overflow-hidden">
              {options.map((option) => {
                const Icon = option.icon
                const isSelected = theme === option.value
                return (
                  <button
                    key={option.value}
                    onClick={() => {
                      setTheme(option.value)
                      setIsOpen(false)
                    }}
                    className={cn(
                      'w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-accent transition-colors',
                      isSelected ? 'text-foreground' : 'text-muted-foreground'
                    )}
                  >
                    <Icon className="h-4 w-4" />
                    {option.label}
                    {isSelected && <Check className="h-4 w-4 ml-auto text-primary" />}
                  </button>
                )
              })}
            </div>
          )}
        </div>
      )
    }
    ```

    Key implementation details:
    - mounted guard prevents SSR/hydration issues
    - resolvedTheme shows actual applied theme (even when set to "system")
    - theme shows selected preference (light/dark/system)
    - Check icon shows current selection
    - Matches NotificationDropdown visual style (same padding, borders, shadows)
  </action>
  <verify>
    - File exists at src/components/theme-toggle.tsx
    - Has "use client" directive
    - Uses mounted state guard
    - Imports useTheme from next-themes
  </verify>
  <done>ThemeToggle component created with three-way selection and hydration safety</done>
</task>

<task type="auto">
  <name>Task 2: Add ThemeToggle to dashboard header</name>
  <files>
    src/app/dashboard/layout.tsx
  </files>
  <action>
    Update src/app/dashboard/layout.tsx to include ThemeToggle in header.

    Changes:
    1. Import ThemeToggle from '@/components/theme-toggle'

    2. Add ThemeToggle in the header's right-side controls area, before NotificationDropdown:
       ```tsx
       <div className="flex items-center space-x-4">
         <ThemeToggle />
         <NotificationDropdown />
       </div>
       ```

    Reasoning:
    - Theme toggle is less frequently used than notifications
    - Placing it before notifications keeps notifications in the "prime" rightmost position
    - space-x-4 provides consistent spacing

    Do NOT change:
    - Sidebar structure
    - Navigation items
    - Mobile menu behavior
    - Sign out button
  </action>
  <verify>
    - Import statement for ThemeToggle exists
    - ThemeToggle appears before NotificationDropdown in header
    - npm run build succeeds
    - npm run dev shows toggle in dashboard header
  </verify>
  <done>ThemeToggle integrated into dashboard header, appearing in top navigation</done>
</task>

</tasks>

<verification>
1. npm run dev and navigate to /dashboard
2. Theme toggle button visible in header (Sun or Moon icon)
3. Click toggle - dropdown shows Light, Dark, System options
4. Select Dark - page immediately switches to dark theme
5. Select Light - page switches back to light theme
6. Select System - follows OS preference
7. Check mark appears next to current selection
8. Clicking outside dropdown closes it
9. Refresh page - theme selection persists
</verification>

<success_criteria>
- ThemeToggle component renders in dashboard header
- Three-way selection (Light/Dark/System) works correctly
- Current selection indicated with checkmark
- Theme changes apply immediately without page reload
- No console errors or hydration warnings
- Dropdown styling matches existing NotificationDropdown
</success_criteria>

<output>
After completion, create `.planning/phases/09-dark-mode-implementation/09-02-SUMMARY.md`
</output>
