---
phase: 13-delete-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/dashboard/reports/page.tsx
autonomous: true

must_haves:
  truths:
    - "Swiping left on a report card reveals a red delete button"
    - "Tapping 3-dots menu on a report card shows a delete option"
    - "Clicking delete removes the report instantly from the list"
    - "Failed delete restores the report to the list"
  artifacts:
    - path: "src/app/dashboard/reports/page.tsx"
      provides: "Reports page with swipe and menu delete"
  key_links:
    - from: "src/app/dashboard/reports/page.tsx"
      to: "/api/reports/[id]"
      via: "fetch DELETE in handleDeleteReport"
      pattern: "fetch.*api/reports.*DELETE"
    - from: "src/app/dashboard/reports/page.tsx"
      to: "src/components/ui/swipeable-list-item.tsx"
      via: "import SwipeableListItem"
      pattern: "import.*SwipeableListItem"
---

<objective>
Add swipe-to-delete and 3-dots kebab menu delete to the reports page.

Purpose: Enable users to delete reports via swipe gesture or context menu, calling the Phase 12 DELETE endpoint with optimistic UI updates.
Output: Working delete interactions on the reports list page.
</objective>

<execution_context>
@/home/dobsondev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dobsondev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-delete-operations-backend/12-01-SUMMARY.md
@src/app/dashboard/reports/page.tsx
@src/app/dashboard/brands/page.tsx (reference for existing kebab menu pattern)
@src/components/ui/swipeable-list-item.tsx (created by 13-01, import the SwipeableListItem component)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add swipe and kebab menu delete to reports page</name>
  <files>
    src/app/dashboard/reports/page.tsx
  </files>
  <action>
    Modify `src/app/dashboard/reports/page.tsx` to add delete functionality:

    1. **Add imports:**
       - `{ useRef }` from react
       - `{ MoreVertical, Trash2 }` from lucide-react
       - `{ SwipeableListItem }` from '@/components/ui/swipeable-list-item'

    2. **Add state:**
       - `const [showMenu, setShowMenu] = useState<string | null>(null)` for kebab menu
       - `const [deleting, setDeleting] = useState<string | null>(null)` for delete loading
       - `const menuRef = useRef<HTMLDivElement>(null)` for click-outside detection

    3. **Add click-outside handler (useEffect):**
       Same pattern as threats page — listen for mousedown when `showMenu` is set, close menu if click is outside `menuRef`.

    4. **Add handleDeleteReport function:**
       Optimistic delete with rollback pattern:
       - Set `deleting` to the report id
       - Backup the report object from state
       - Remove report from `reports` array immediately (optimistic)
       - Call `fetch('/api/reports/${id}', { method: 'DELETE' })`
       - If response not ok, throw error
       - On catch: restore report to state (add back and re-sort by created_at desc), show `alert('Failed to delete report. Please try again.')`
       - Finally: set `deleting` to null

    5. **Update the report card rendering:**
       The reports page uses individual `<Card>` elements per report (not a single card with divide-y like threats).

       Wrap each report card in `<SwipeableListItem onDelete={() => handleDeleteReport(report.id)} disabled={deleting === report.id}>`.

       Add the kebab menu to each report card:
       - Position a 3-dots menu button in the top-right of the card content area (similar to brands page pattern)
       - Use a container `div` with `ref={menuRef}` and `className="absolute top-4 right-4"` (or relative within the card flex layout at the far right of the first row)
       - MoreVertical button: `p-2 text-muted-foreground hover:text-foreground rounded-lg hover:bg-muted transition-colors` with `aria-label="More options"`
       - Stop propagation on click to prevent card interaction
       - Dropdown menu: `absolute right-0 mt-1 w-48 bg-card border border-border rounded-lg shadow-lg py-1 z-20`
       - Delete menu item: Trash2 icon + "Delete Report" text, `text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30`
       - Disabled when `deleting === report.id`

    6. **Layout adjustment:** The report card currently uses a flex layout with content on the left and action buttons (Download, Send) on the right. Place the kebab menu between the action buttons area and the content, or at the top-right of the card. Use the `relative` class on the Card and position the menu `absolute top-4 right-4` — matching the brands page pattern.

    7. **Dark mode:** Apply `dark:hover:bg-red-950/30` for the delete hover state.
  </action>
  <verify>
    Run `npx next build` to verify build passes.
    Grep for `handleDeleteReport` and `SwipeableListItem` in reports/page.tsx to confirm integration.
  </verify>
  <done>
    Reports page has working 3-dots menu with delete option and swipe-to-delete on each report card. Delete calls /api/reports/[id] DELETE endpoint, optimistically removes from list, and rolls back on error.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `src/app/dashboard/reports/page.tsx` imports SwipeableListItem and has handleDeleteReport
3. Reports page renders kebab menu with delete option per report card
4. Delete handler calls `fetch('/api/reports/${id}', { method: 'DELETE' })`
5. Optimistic removal with rollback on error
</verification>

<success_criteria>
- Reports page has swipe-to-delete and 3-dots menu delete
- Optimistic UI: report removed from list immediately, restored on error
- No confirmation dialog (instant delete per project requirements)
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/13-delete-ui/13-02-SUMMARY.md`
</output>
