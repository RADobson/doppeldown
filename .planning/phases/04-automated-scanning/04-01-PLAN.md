---
phase: 04-automated-scanning
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260127200001_add_auto_scan_enabled.sql
  - src/lib/tier-limits.ts
autonomous: true

must_haves:
  truths:
    - "brands table has auto_scan_enabled boolean column"
    - "scanFrequencyHours field exists for each tier"
    - "Free tier returns null for scanFrequencyHours"
    - "Starter=24h, Professional=6h, Enterprise=1h"
  artifacts:
    - path: "supabase/migrations/20260127200001_add_auto_scan_enabled.sql"
      provides: "auto_scan_enabled column with default true"
      contains: "auto_scan_enabled"
    - path: "src/lib/tier-limits.ts"
      provides: "Hours-based scan frequency"
      contains: "scanFrequencyHours"
  key_links:
    - from: "src/lib/tier-limits.ts"
      to: "TierLimits interface"
      via: "scanFrequencyHours field"
      pattern: "scanFrequencyHours.*number.*null"
---

<objective>
Add auto_scan_enabled column to brands table and update tier-limits to use hours-based scan frequency.

Purpose: Foundation for tier-appropriate automated scanning with brand-level pause control.
Output: Migration file + updated tier-limits.ts with scanFrequencyHours field.
</objective>

<execution_context>
@/home/dobsondev/.claude/get-shit-done/workflows/execute-plan.md
@/home/dobsondev/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-automated-scanning/04-CONTEXT.md
@.planning/phases/04-automated-scanning/04-RESEARCH.md
@src/lib/tier-limits.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto_scan_enabled migration</name>
  <files>supabase/migrations/20260127200001_add_auto_scan_enabled.sql</files>
  <action>
Create migration adding:
1. `auto_scan_enabled` boolean column to brands table with DEFAULT true
2. Partial index for scheduling query: `idx_brands_auto_scan_scheduling` on (last_scan_at DESC) WHERE status = 'active' AND auto_scan_enabled = true
3. Comment on index explaining purpose

Use timestamp format matching existing migrations (YYYYMMDD prefix + sequence).
  </action>
  <verify>File exists and contains ALTER TABLE, CREATE INDEX, and WHERE clause</verify>
  <done>Migration file ready for supabase db push</done>
</task>

<task type="auto">
  <name>Task 2: Update tier-limits with hours-based frequency</name>
  <files>src/lib/tier-limits.ts</files>
  <action>
1. Add `scanFrequencyHours: number | null` to TierLimits interface (null = manual only)
2. Update TIER_LIMITS object:
   - free: scanFrequencyHours = null (manual only)
   - starter: scanFrequencyHours = 24 (daily)
   - professional: scanFrequencyHours = 6 (every 6 hours)
   - enterprise: scanFrequencyHours = 1 (hourly)
3. Keep existing scanFrequencyDays for backward compatibility (will remove in future)
4. Add helper function `getScanFrequencyHours(tier: string): number | null`

Do NOT remove scanFrequencyDays yet - cron endpoint still uses it until Plan 02.
  </action>
  <verify>grep -E "scanFrequencyHours" src/lib/tier-limits.ts shows field in interface and all 4 tiers</verify>
  <done>TierLimits has scanFrequencyHours: free=null, starter=24, professional=6, enterprise=1</done>
</task>

</tasks>

<verification>
- [ ] Migration file exists with auto_scan_enabled column
- [ ] Partial index created for scheduling optimization
- [ ] tier-limits.ts exports scanFrequencyHours for all tiers
- [ ] Free tier returns null (manual only)
- [ ] TypeScript compiles: `npx tsc --noEmit`
</verification>

<success_criteria>
- Migration adds auto_scan_enabled boolean with default true
- Partial index optimizes cron scheduling query
- scanFrequencyHours matches CONTEXT.md specs: null/24/6/1
- Existing scanFrequencyDays preserved for backward compat
</success_criteria>

<output>
After completion, create `.planning/phases/04-automated-scanning/04-01-SUMMARY.md`
</output>
