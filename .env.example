# ============================================================================
# DoppelDown Environment Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# Supabase Configuration (Required)
# ----------------------------------------------------------------------------
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# ----------------------------------------------------------------------------
# Stripe Configuration (Required)
# ----------------------------------------------------------------------------
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_STARTER_PRICE_ID=price_...
STRIPE_PRO_PRICE_ID=price_...
STRIPE_ENTERPRISE_PRICE_ID=price_...

# ----------------------------------------------------------------------------
# App Configuration
# ----------------------------------------------------------------------------
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ----------------------------------------------------------------------------
# Redis / Caching Configuration (Optional but recommended for production)
# ----------------------------------------------------------------------------
# Redis URL for caching (supports redis:// and rediss:// for TLS)
# Get a free Redis instance from Upstash (upstash.com) or Redis Cloud
REDIS_URL=
# Example: REDIS_URL=redis://default:password@host:6379
# Example with TLS: REDIS_URL=rediss://default:password@host:6379

# Cache key prefix (optional, defaults to 'doppeldown:')
CACHE_KEY_PREFIX=doppeldown:

# Default cache TTL in seconds (optional, defaults to 300 = 5 minutes)
CACHE_DEFAULT_TTL=300

# Max in-memory cache entries when Redis is unavailable (optional, defaults to 10000)
CACHE_MAX_MEMORY_ENTRIES=10000

# Enable debug logging for cache operations (optional)
CACHE_DEBUG=false

# ----------------------------------------------------------------------------
# Evidence Storage Configuration
# ----------------------------------------------------------------------------
SUPABASE_EVIDENCE_BUCKET=evidence
SUPABASE_EVIDENCE_PUBLIC=false
EVIDENCE_SCREENSHOTS_ENABLED=true
EVIDENCE_HTML_MAX_BYTES=1048576
EVIDENCE_SIGNED_URL_TTL_SECONDS=3600

# ----------------------------------------------------------------------------
# Logo & Image Search Configuration
# ----------------------------------------------------------------------------
SUPABASE_LOGO_BUCKET=logos
LOGO_MAX_BYTES=5242880
LOGO_SEARCH_PROVIDER=google_vision
LOGO_SEARCH_FALLBACK=serpapi
LOGO_SEARCH_MAX_RESULTS=15

# Google Vision API (for logo search)
GOOGLE_VISION_API_KEY=

# SerpAPI (fallback for logo and web search)
SERPAPI_API_KEY=

# ----------------------------------------------------------------------------
# Search Provider Configuration
# ----------------------------------------------------------------------------
WEB_SEARCH_PROVIDER=serpapi
SOCIAL_SEARCH_PROVIDER=serpapi
WEB_SEARCH_FALLBACK=true
SOCIAL_SEARCH_FALLBACK=true

# ----------------------------------------------------------------------------
# OpenAI Configuration (for AI threat analysis)
# ----------------------------------------------------------------------------
OPENAI_API_KEY=
VISION_PROVIDER=openai
OPENAI_VISION_MODEL=gpt-4o-mini
OPENAI_INTENT_MODEL=gpt-4o-mini
OPENAI_INTENT_ENABLED=true
OPENAI_VISION_ENABLED=true
PHISHING_INTENT_MAX_CHARS=4000

# ----------------------------------------------------------------------------
# Email Configuration (SMTP Alert System)
# ----------------------------------------------------------------------------
# Comprehensive SMTP email service with connection pooling, retry logic,
# and detailed logging for reliable alert delivery.

# ----------------
# SMTP Server Settings (Required for email alerts)
# ----------------
# SMTP server hostname
SMTP_HOST=smtp.gmail.com

# SMTP server port (common: 25, 465 for SSL, 587 for STARTTLS)
SMTP_PORT=587

# Use SSL/TLS (auto-detected: true for port 465, false otherwise)
# SMTP_SECURE=false

# SMTP authentication credentials
SMTP_USER=
SMTP_PASS=

# ----------------
# Connection Pool Settings
# ----------------
# Connection timeout in milliseconds (default: 30000 = 30 seconds)
SMTP_CONNECTION_TIMEOUT=30000

# Socket timeout in milliseconds (default: 60000 = 60 seconds)
SMTP_SOCKET_TIMEOUT=60000

# Maximum concurrent connections (default: 5)
SMTP_MAX_CONNECTIONS=5

# Messages per connection before reconnecting (default: 100)
SMTP_MAX_MESSAGES=100

# Enable SMTP debug logging (default: false)
SMTP_DEBUG=false

# ----------------
# TLS Settings
# ----------------
# Reject unauthorized certificates (default: true, set false for self-signed)
# SMTP_TLS_REJECT_UNAUTHORIZED=true

# Minimum TLS version (e.g., TLSv1.2)
# SMTP_TLS_MIN_VERSION=TLSv1.2

# ----------------
# Email Service Settings
# ----------------
# Default from address for emails
EMAIL_FROM=alerts@doppeldown.app

# Reply-to address (optional)
EMAIL_REPLY_TO=support@doppeldown.app

# Enable/disable email sending (default: true)
EMAIL_ENABLED=true

# Log email content for debugging (default: false, WARNING: may expose PII)
EMAIL_LOG_CONTENT=false

# ----------------
# Retry Configuration
# ----------------
# Maximum retry attempts for failed emails (default: 5)
EMAIL_MAX_RETRIES=5

# Base delay between retries in milliseconds (default: 1000 = 1 second)
EMAIL_RETRY_DELAY_MS=1000

# Exponential backoff multiplier (default: 2)
# EMAIL_RETRY_BACKOFF=2

# Maximum retry delay in milliseconds (default: 300000 = 5 minutes)
EMAIL_MAX_RETRY_DELAY_MS=300000

# ----------------
# Queue Configuration
# ----------------
# Queue processing interval in milliseconds (default: 5000 = 5 seconds)
EMAIL_QUEUE_INTERVAL_MS=5000

# Maximum emails in queue (default: 1000)
EMAIL_MAX_QUEUE_SIZE=1000

# Rate limit: emails per minute (default: 30)
EMAIL_RATE_LIMIT=30

# ----------------------------------------------------------------------------
# React Email / Resend Configuration (Transactional Emails)
# ----------------------------------------------------------------------------
# Get your API key from https://resend.com
RESEND_API_KEY=re_...

# From email address (must be verified in Resend)
FROM_EMAIL=DoppelDown <noreply@doppeldown.com>

# Reply-to email address
REPLY_TO_EMAIL=support@doppeldown.com

# ----------------------------------------------------------------------------
# Scan Worker Configuration (Puppeteer)
# ----------------------------------------------------------------------------
PUPPETEER_EXECUTABLE_PATH=

# Scan timeouts and limits
SCAN_NETWORK_TIMEOUT_MS=4000
SCAN_MAX_QUERIES=5
SCAN_ADDED_LETTER_LIMIT=25
SCAN_SEED_PLURAL_LIMIT=12
SCAN_PRIORITY_TLDS=com,net,org

# Progress update interval in ms
SCAN_PROGRESS_INTERVAL_MS=1500

# How often to check for cancellation (every N domains)
SCAN_CANCEL_CHECK_EVERY=25

# ----------------------------------------------------------------------------
# Threat Intelligence Configuration
# ----------------------------------------------------------------------------
# Comprehensive threat intelligence system with multiple providers.
# Some are free (no key required), others need API keys.

# ----------------
# Primary APIs (Highly Recommended)
# ----------------

# VirusTotal API - Multi-engine malware scanning
# Get a free API key at https://www.virustotal.com (4 req/min free tier)
VIRUSTOTAL_API_KEY=
ENABLE_VIRUSTOTAL=true

# Google Safe Browsing - Google's malware/phishing database
# Get a free API key at https://console.cloud.google.com/apis/library/safebrowsing.googleapis.com
GOOGLE_SAFE_BROWSING_API_KEY=
ENABLE_GOOGLE_SAFE_BROWSING=true

# ----------------
# Secondary APIs (Recommended)
# ----------------

# AbuseIPDB - IP reputation and abuse reports
# Get a free API key at https://www.abuseipdb.com (1000 checks/day free)
ABUSEIPDB_API_KEY=
ENABLE_ABUSEIPDB=true

# HaveIBeenPwned - Breach data for domains
# Get an API key at https://haveibeenpwned.com/API/Key (paid)
HIBP_API_KEY=
ENABLE_HIBP=true

# URLScan.io - URL analysis and screenshots
# Get a free API key at https://urlscan.io (5000 scans/day free)
URLSCAN_API_KEY=
ENABLE_URLSCAN=true

# ----------------
# Free Threat Feeds (No API Key Required)
# ----------------

# PhishTank - Community phishing database
# Optional API key improves rate limits: https://phishtank.org/api_info.php
PHISHTANK_API_KEY=
ENABLE_PHISHTANK=true

# URLhaus (abuse.ch) - Malware URL database
ENABLE_URLHAUS=true

# OpenPhish - Phishing URL feed
ENABLE_OPENPHISH=true

# ----------------
# Domain Intelligence (No API Key Required)
# ----------------

# Domain age checking via RDAP
ENABLE_DOMAIN_AGE=true

# SSL certificate analysis
ENABLE_SSL_CHECK=true

# DNS configuration analysis
ENABLE_DNS_CHECK=true

# ----------------
# Rate Limits (requests per minute)
# ----------------
RATE_LIMIT_VIRUSTOTAL=4
RATE_LIMIT_GSB=100
RATE_LIMIT_ABUSEIPDB=60
RATE_LIMIT_HIBP=10
RATE_LIMIT_URLSCAN=60
RATE_LIMIT_PHISHTANK=30
RATE_LIMIT_URLHAUS=60
RATE_LIMIT_WHOIS=30

# ----------------
# Cache TTLs (seconds)
# ----------------
CACHE_TTL_DOMAIN_AGE=86400
CACHE_TTL_SSL=3600
CACHE_TTL_DNS=1800
CACHE_TTL_THREAT_FEEDS=1800
CACHE_TTL_EXTERNAL_APIS=3600

# ----------------
# Scoring Weights (should sum to 1.0)
# ----------------
WEIGHT_DOMAIN_AGE=0.10
WEIGHT_SSL=0.08
WEIGHT_DNS=0.07
WEIGHT_THREAT_FEEDS=0.35
WEIGHT_EXTERNAL_REPUTATION=0.25
WEIGHT_INFRASTRUCTURE=0.10
WEIGHT_BEHAVIORAL=0.05

# ----------------
# Severity Thresholds
# ----------------
THRESHOLD_CRITICAL=80
THRESHOLD_HIGH=60
THRESHOLD_MEDIUM=40
THRESHOLD_LOW=20

# ----------------
# Timeouts
# ----------------
THREAT_INTEL_TIMEOUT_MS=10000
THREAT_INTEL_MAX_RETRIES=2
THREAT_INTEL_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# Monitoring & Metrics Configuration
# ----------------------------------------------------------------------------
# API token for Prometheus metrics endpoint security
# Generate a secure random string: openssl rand -hex 32
METRICS_API_TOKEN=

# Monitoring dashboard API token (defaults to METRICS_API_TOKEN if not set)
MONITORING_API_TOKEN=

# Enable detailed request metrics (may impact performance)
METRICS_DETAILED_ROUTES=false

# Metrics push interval for pushgateway (ms)
METRICS_PUSH_INTERVAL=60000

# Sentry DSN for error tracking (optional)
SENTRY_DSN=

# Enable performance monitoring in Sentry
SENTRY_TRACES_SAMPLE_RATE=0.1

# External log shipping endpoint (Datadog, Logtail, etc.)
LOG_ENDPOINT_URL=
LOG_ENDPOINT_TOKEN=

# Log level (debug, info, warn, error, fatal)
LOG_LEVEL=info

# Slow request threshold in ms (default: 3000)
SLOW_REQUEST_THRESHOLD_MS=3000

# Slow database query threshold in ms (default: 500)
SLOW_QUERY_THRESHOLD_MS=500

# Alert webhook URL (Slack, Discord, PagerDuty)
ALERT_WEBHOOK_URL=
ALERT_SECONDARY_WEBHOOK_URL=

# Alert email address for critical alerts
ALERT_EMAIL=

# Alert cooldown in ms to prevent duplicate alerts (default: 300000 = 5 min)
ALERT_COOLDOWN_MS=300000

# Maximum alerts per hour before throttling (default: 30)
ALERT_MAX_PER_HOUR=30

# ----------------------------------------------------------------------------
# SEO & Analytics Configuration
# ----------------------------------------------------------------------------
# Site URL (used for canonical URLs and sitemap)
NEXT_PUBLIC_SITE_URL=https://doppeldown.com

# Google Search Console verification code
# Get this from Google Search Console > Settings > Ownership verification
GOOGLE_SITE_VERIFICATION=

# Bing Webmaster Tools verification code
BING_SITE_VERIFICATION=

# Yandex Webmaster verification code
YANDEX_SITE_VERIFICATION=

# Google Analytics 4 Measurement ID
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX

# Google Tag Manager Container ID
NEXT_PUBLIC_GTM_ID=GTM-XXXXXXX

# Web Vitals analytics endpoint (optional)
# Set to your analytics endpoint to collect Core Web Vitals data
NEXT_PUBLIC_VITALS_ENDPOINT=

# ----------------------------------------------------------------------------
# Optional: Feature Flags
# ----------------------------------------------------------------------------
# Disable AI analysis for testing
# OPENAI_INTENT_ENABLED=false
# OPENAI_VISION_ENABLED=false
